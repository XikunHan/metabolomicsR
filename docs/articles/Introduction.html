<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="metabolomicsR">
<title>An introduction to the metabolomicsR • metabolomicsR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to the metabolomicsR">
<meta property="og:description" content="metabolomicsR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">metabolomicsR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Introduction.html">An introduction to the metabolomicsR</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/XikunHan/metabolomicsR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>An introduction to the metabolomicsR</h1>
                        <h4 data-toc-skip class="author">Xikun Han</h4>
                        
      
      <small class="dont-index">Source: <a href="https://github.com/XikunHan/metabolomicsR/blob/HEAD/vignettes/Introduction.Rmd" class="external-link"><code>vignettes/Introduction.Rmd</code></a></small>
      <div class="d-none name"><code>Introduction.Rmd</code></div>
    </div>

    
    
<p><br><strong><a href="https://github.com/XikunHan/metabolomicsR" class="external-link">metabolomicsR</a>: Tools to process, analyze,
and visualize metabolomic data.</strong></p>
<p><strong>metabolomicsR</strong> is a streamlined R package to
preprocess, analyze, and visualize metabolomic data. We included a set
of functions for sample and metabolite quality control, outlier
detection, missing value imputation, dimensional reduction,
normalization, data integration, regression analysis, annotation, and
visualization of data and results. The <strong>metabolomicsR</strong> is
designed to be a comprehensive R package that can be easily used by
researchers with basic R programming skills. The framework designed here
is also versatile and extensible to various methods and metabolomic
platforms. Here, we demonstrate the step-by-step use of the main
functions from this package.</p>
<p><strong>Figure:</strong> Seamless workflow to preprocess, analyze,
and visualize metabolomic data in <strong>metabolomicsR</strong>
<img src="../reference/figures/workflow.png" align="center" width="120%" height="180%"></p>
<p><br></p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<table class="table">
<thead><tr class="header">
<th>Type</th>
<th>Command</th>
</tr></thead>
<tbody><tr class="odd">
<td>Development</td>
<td><code>remotes::install_github("XikunHan/metabolomicsR")</code></td>
</tr></tbody>
</table>
<p><br><br></p>
</div>
<div class="section level2">
<h2 id="data-structure">Data structure<a class="anchor" aria-label="anchor" href="#data-structure"></a>
</h2>
<p>We first designed a “Metabolite” class based on the object-oriented
programming system S4 in R. For a particular “Metabolite” data, it will
include “assayData” (eg. peak area data or batch-normalized data,
samples in rows and metabolites in columns), “featureData” (metabolite
annotation), “sampleData” (sample annotation), “featureID”, “sampleID”,
“logs” (log information of data analysis process), and “miscData” (other
ancillary data). For metabolites, current platforms typically measure
~1,000 features. It will be much easier to manipulate the data with
samples in rows and metabolites in columns, rather than the
<a href="https://bioconductor.org/packages/SummarizedExperiment" class="external-link">SummarizedExperiment</a> container where the columns
represent samples.</p>
<p><br><br></p>
</div>
<div class="section level2">
<h2 id="import-data">Import data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h2>
<p>To demonstrate the package, we obtained metabolomic data from Qatar
Metabolomics Study on Diabetes, similar to the data format from
non-targeted mass spectrometry by Metabolon. The dataset is available
via <a href="https://doi.org/10.6084/m9.figshare.5904022" class="external-link">figshare</a>.</p>
<p>The data can be imported directly from excel, csv or other formats
that imported into R.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/XikunHan/metabolomicsR" class="external-link">metabolomicsR</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sachsmc.github.io/plotROC/" class="external-link">plotROC</a></span><span class="op">)</span>

<span class="co"># Load the metabolomic dataset from an excel file</span>

<span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"QMDiab_metabolomics_OrigScale.xlsx"</span>, package <span class="op">=</span> <span class="st">"metabolomicsR"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">df_plasma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_excel.html">load_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">file_path</span>,
                        data_sheet <span class="op">=</span> <span class="fl">1</span>,
                        feature_sheet <span class="op">=</span> <span class="fl">4</span>,
                        sample_sheet <span class="op">=</span> <span class="fl">8</span>,
                        sampleID <span class="op">=</span> <span class="st">"QMDiab-ID"</span>,
                        featureID <span class="op">=</span> <span class="st">"BIOCHEMICAL"</span>
                        <span class="op">)</span>

<span class="co"># To save the data in disc. </span>
<span class="co"># save_data(df_plasma, file = "~/test")</span></code></pre></div>
<p>In the “assayData”, the first column is the sample IDs to match with
“sampleData”, the other columns are metabolite IDs to match with
“featureData”.</p>
<p><br></p>
<details><summary><strong>click to show plasma data</strong>
</summary><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_plasma</span></code></pre></div>
<pre><code><span class="co">## An object of  Metabolite </span>
<span class="co">## </span>
<span class="co">## ***  @assayData (first and last 10 columns [ 356  *  759 ])  ***</span>
<span class="co">##       sampleID 1,11-Undecanedicarboxylic acid 1,2-dipalmitoylglycerol</span>
<span class="co">##   1: QMDiab222                           8578                      NA</span>
<span class="co">##   2: QMDiab113                          15145                      NA</span>
<span class="co">##   3:  QMDiab29                             NA                   96455</span>
<span class="co">##   4: QMDiab243                          19692                   69444</span>
<span class="co">##   5: QMDiab270                             NA                      NA</span>
<span class="co">##  ---                                                                 </span>
<span class="co">## 352: QMDiab352                           6689                  116932</span>
<span class="co">## 353: QMDiab135                           7556                  248824</span>
<span class="co">## 354: QMDiab229                          20252                   80804</span>
<span class="co">## 355: QMDiab202                           7378                  108152</span>
<span class="co">## 356: QMDiab103                           6667                   57851</span>
<span class="co">##      1,2-propanediol 1,3,7-trimethylurate 1,3-dihydroxyacetone</span>
<span class="co">##   1:          103724                22259               104059</span>
<span class="co">##   2:              NA                39841                   NA</span>
<span class="co">##   3:          159945                10605               165416</span>
<span class="co">##   4:          108965                38562               139866</span>
<span class="co">##   5:          157617                 4490                   NA</span>
<span class="co">##  ---                                                          </span>
<span class="co">## 352:          115737                34791               152711</span>
<span class="co">## 353:          481008                 4766               164853</span>
<span class="co">## 354:          138253                13949                85019</span>
<span class="co">## 355:          112229                21748               175918</span>
<span class="co">## 356:          146948                 8458                82064</span>
<span class="co">##      1,3-dipalmitoylglycerol 1,5-anhydroglucitol (1,5-AG) 1,7-dimethylurate</span>
<span class="co">##   1:                    7067                       357499             19986</span>
<span class="co">##   2:                   36542                       440058             16620</span>
<span class="co">##   3:                   54209                       355790             12220</span>
<span class="co">##   4:                   22412                       185273             29537</span>
<span class="co">##   5:                   21958                       692753             10256</span>
<span class="co">##  ---                                                                       </span>
<span class="co">## 352:                   59120                       178759             25326</span>
<span class="co">## 353:                  126065                       103647             12253</span>
<span class="co">## 354:                   43072                       330579             15124</span>
<span class="co">## 355:                   78154                       106745             21434</span>
<span class="co">## 356:                   34234                       534697             12979</span>
<span class="co">##      1-arachidonoylglycerophosphocholine* X - 19183 X - 19299 X - 19302</span>
<span class="co">##   1:                              2173598        NA        NA        NA</span>
<span class="co">##   2:                              2464846        NA      9033        NA</span>
<span class="co">##   3:                              2613798        NA     10231        NA</span>
<span class="co">##   4:                              2543266        NA        NA     12291</span>
<span class="co">##   5:                              2138029        NA      6775        NA</span>
<span class="co">##  ---                                                                   </span>
<span class="co">## 352:                               864647        NA        NA        NA</span>
<span class="co">## 353:                              3018611      4769        NA        NA</span>
<span class="co">## 354:                              1398965        NA        NA        NA</span>
<span class="co">## 355:                              2104899        NA        NA        NA</span>
<span class="co">## 356:                               992388        NA        NA        NA</span>
<span class="co">##      X - 19380 X - 19411 X - 19434 X - 19436 X - 19437 X - 19438 X - 19451</span>
<span class="co">##   1:    158054     88569      7539        NA     64644     18055        NA</span>
<span class="co">##   2:    125669     87268     12681        NA     52074     12805      2994</span>
<span class="co">##   3:    194732    106360      7787        NA     31782     18467        NA</span>
<span class="co">##   4:    152853    119643        NA        NA     67713     12356        NA</span>
<span class="co">##   5:    204978    149644        NA        NA    108660     12479        NA</span>
<span class="co">##  ---                                                                      </span>
<span class="co">## 352:    195331    134564        NA        NA     22141     17205        NA</span>
<span class="co">## 353:    136120     75431     10876        NA     61867     28223        NA</span>
<span class="co">## 354:    216380    128925        NA        NA     84299     14936        NA</span>
<span class="co">## 355:    162256    112923        NA        NA     42586     51588        NA</span>
<span class="co">## 356:    137705    112636        NA        NA     89283     23515     10619</span>
<span class="co">##      X - 19574</span>
<span class="co">##   1:        NA</span>
<span class="co">##   2:        NA</span>
<span class="co">##   3:        NA</span>
<span class="co">##   4:        NA</span>
<span class="co">##   5:        NA</span>
<span class="co">##  ---          </span>
<span class="co">## 352:        NA</span>
<span class="co">## 353:     16573</span>
<span class="co">## 354:        NA</span>
<span class="co">## 355:        NA</span>
<span class="co">## 356:        NA</span>
<span class="co">## </span>
<span class="co">## ***  @featureData (ID:  featureID ) ***</span>
<span class="co">##                           featureID PATHWAY_SORTORDER</span>
<span class="co">##   1: 1,11-Undecanedicarboxylic acid             800.1</span>
<span class="co">##   2:        1,2-dipalmitoylglycerol              1070</span>
<span class="co">##   3:                1,2-propanediol               986</span>
<span class="co">##   4:           1,3,7-trimethylurate              1805</span>
<span class="co">##   5:           1,3-dihydroxyacetone               600</span>
<span class="co">##  ---                                                 </span>
<span class="co">## 754:                      X - 19436              &lt;NA&gt;</span>
<span class="co">## 755:                      X - 19437              &lt;NA&gt;</span>
<span class="co">## 756:                      X - 19438              &lt;NA&gt;</span>
<span class="co">## 757:                      X - 19451              &lt;NA&gt;</span>
<span class="co">## 758:                      X - 19574              &lt;NA&gt;</span>
<span class="co">##                         BIOCHEMICAL SUPER_PATHWAY</span>
<span class="co">##   1: 1,11-Undecanedicarboxylic acid         Lipid</span>
<span class="co">##   2:        1,2-dipalmitoylglycerol         Lipid</span>
<span class="co">##   3:                1,2-propanediol         Lipid</span>
<span class="co">##   4:           1,3,7-trimethylurate   Xenobiotics</span>
<span class="co">##   5:           1,3-dihydroxyacetone  Carbohydrate</span>
<span class="co">##  ---                                             </span>
<span class="co">## 754:                      X - 19436          &lt;NA&gt;</span>
<span class="co">## 755:                      X - 19437          &lt;NA&gt;</span>
<span class="co">## 756:                      X - 19438          &lt;NA&gt;</span>
<span class="co">## 757:                      X - 19451          &lt;NA&gt;</span>
<span class="co">## 758:                      X - 19574          &lt;NA&gt;</span>
<span class="co">##                                           SUB_PATHWAY COMP_ID  PLATFORM</span>
<span class="co">##   1:                        Fatty acid, dicarboxylate   43027 LC/MS Neg</span>
<span class="co">##   2:                                   Diacylglycerol   11953     GC/MS</span>
<span class="co">##   3:                                    Ketone bodies   38002     GC/MS</span>
<span class="co">##   4:                              Xanthine metabolism   34404 LC/MS Neg</span>
<span class="co">##   5: Glycolysis, gluconeogenesis, pyruvate metabolism   35963     GC/MS</span>
<span class="co">##  ---                                                                   </span>
<span class="co">## 754:                                             &lt;NA&gt;   42912 LC/MS Neg</span>
<span class="co">## 755:                                             &lt;NA&gt;   42913 LC/MS Neg</span>
<span class="co">## 756:                                             &lt;NA&gt;   42914 LC/MS Neg</span>
<span class="co">## 757:                                             &lt;NA&gt;   42927 LC/MS Neg</span>
<span class="co">## 758:                                             &lt;NA&gt;   43130 LC/MS Neg</span>
<span class="co">##                      RI               MASS PUBCHEM                 CAS   KEGG</span>
<span class="co">##   1:               3578              243.2   10458           505-52-2;   &lt;NA&gt;</span>
<span class="co">##   2:               2600                145   99931         40290-32-2;   &lt;NA&gt;</span>
<span class="co">##   3:               1041                117    &lt;NA&gt;            57-55-6; C00583</span>
<span class="co">##   4:               1988              209.1   79437          5415-44-1; C16361</span>
<span class="co">##   5:               1263                103     670 96-26-4;62147-49-3; C00184</span>
<span class="co">##  ---                                                                         </span>
<span class="co">## 754:               4747              467.4    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span>
<span class="co">## 755: 1150.0999999999999              397.1    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span>
<span class="co">## 756:             1222.3              217.1    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span>
<span class="co">## 757:             3728.5              239.1    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span>
<span class="co">## 758:             4045.7 307.10000000000002    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span>
<span class="co">##        HMDb_ID COMP_IDstr</span>
<span class="co">##   1: HMDB02327     M43027</span>
<span class="co">##   2: HMDB07098     M11953</span>
<span class="co">##   3: HMDB01881     M38002</span>
<span class="co">##   4: HMDB02123     M34404</span>
<span class="co">##   5: HMDB01882     M35963</span>
<span class="co">##  ---                     </span>
<span class="co">## 754:      &lt;NA&gt;     M42912</span>
<span class="co">## 755:      &lt;NA&gt;     M42913</span>
<span class="co">## 756:      &lt;NA&gt;     M42914</span>
<span class="co">## 757:      &lt;NA&gt;     M42927</span>
<span class="co">## 758:      &lt;NA&gt;     M43130</span>
<span class="co">## </span>
<span class="co">## ***  @sampleData (ID:  sampleID ) ***</span>
<span class="co">##       sampleID      AGE GENDER      BMI ETHNICITY T2D</span>
<span class="co">##   1: QMDiab222 34.50513      0 25.01021         2   0</span>
<span class="co">##   2: QMDiab113 47.06639      1 28.36776         3   0</span>
<span class="co">##   3:  QMDiab29 55.49076      1 29.70564         1   0</span>
<span class="co">##   4: QMDiab243 56.33402      1 23.14050         2   0</span>
<span class="co">##   5: QMDiab270 35.63039      1 30.06229         1   0</span>
<span class="co">##  ---                                                 </span>
<span class="co">## 352: QMDiab352 41.55510      1 31.22690         3   1</span>
<span class="co">## 353: QMDiab135 52.55305      0 29.07577         2   1</span>
<span class="co">## 354: QMDiab229 30.31348      0 22.22656         2   0</span>
<span class="co">## 355: QMDiab202 49.40999      1 33.72008         1   1</span>
<span class="co">## 356: QMDiab103 23.85489      0 35.96389         1   0</span>
<span class="co">## </span>
<span class="co">## ***  @miscData  ***</span>
<span class="co">## integer(0)</span>
<span class="co">## </span>
<span class="co">## ***  @logs  ***</span>
<span class="co">## 19/08/22 11:30:55: Import data from: /private/var/folders/mj/lsf2tqcx13d5tgl627mm9fxm0000gn/T/RtmpZ5htRD/temp_libpath862b4f79a4da/metabolomicsR/extdata/QMDiab_metabolomics_OrigScale.xlsx .</span>
<span class="co">## 19/08/22 11:30:55: Initiate data: 356 samples and 758 features.</span></code></pre>
</details><p>The <code>{update_Metabolite}</code> function provides several
methods to update the data, including “injection_order”, “keep_feature”,
“remove_feature”, “keep_sample”, “remove_sample”,
“add_sample_annotation”, and “change_featureID”.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># change the feature ID to the column `COMP_IDstr`</span>
<span class="va">df_plasma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/update_Metabolite.html">update_Metabolite</a></span><span class="op">(</span><span class="va">df_plasma</span>, dataset <span class="op">=</span> <span class="st">"COMP_IDstr"</span>, action <span class="op">=</span> <span class="st">"change_featureID"</span><span class="op">)</span></code></pre></div>
<p><br></p>
<details><summary><strong>click to show plasma data</strong>
</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_plasma</span></code></pre></div>
<pre><code><span class="co">## An object of  Metabolite </span>
<span class="co">## </span>
<span class="co">## ***  @assayData (first and last 10 columns [ 356  *  759 ])  ***</span>
<span class="co">##       sampleID M43027 M11953 M38002 M34404 M35963 M35728 M20675 M34400  M33228</span>
<span class="co">##   1: QMDiab222   8578     NA 103724  22259 104059   7067 357499  19986 2173598</span>
<span class="co">##   2: QMDiab113  15145     NA     NA  39841     NA  36542 440058  16620 2464846</span>
<span class="co">##   3:  QMDiab29     NA  96455 159945  10605 165416  54209 355790  12220 2613798</span>
<span class="co">##   4: QMDiab243  19692  69444 108965  38562 139866  22412 185273  29537 2543266</span>
<span class="co">##   5: QMDiab270     NA     NA 157617   4490     NA  21958 692753  10256 2138029</span>
<span class="co">##  ---                                                                          </span>
<span class="co">## 352: QMDiab352   6689 116932 115737  34791 152711  59120 178759  25326  864647</span>
<span class="co">## 353: QMDiab135   7556 248824 481008   4766 164853 126065 103647  12253 3018611</span>
<span class="co">## 354: QMDiab229  20252  80804 138253  13949  85019  43072 330579  15124 1398965</span>
<span class="co">## 355: QMDiab202   7378 108152 112229  21748 175918  78154 106745  21434 2104899</span>
<span class="co">## 356: QMDiab103   6667  57851 146948   8458  82064  34234 534697  12979  992388</span>
<span class="co">##      M42659 M42775 M42778 M42856 M42887 M42910 M42912 M42913 M42914 M42927</span>
<span class="co">##   1:     NA     NA     NA 158054  88569   7539     NA  64644  18055     NA</span>
<span class="co">##   2:     NA   9033     NA 125669  87268  12681     NA  52074  12805   2994</span>
<span class="co">##   3:     NA  10231     NA 194732 106360   7787     NA  31782  18467     NA</span>
<span class="co">##   4:     NA     NA  12291 152853 119643     NA     NA  67713  12356     NA</span>
<span class="co">##   5:     NA   6775     NA 204978 149644     NA     NA 108660  12479     NA</span>
<span class="co">##  ---                                                                      </span>
<span class="co">## 352:     NA     NA     NA 195331 134564     NA     NA  22141  17205     NA</span>
<span class="co">## 353:   4769     NA     NA 136120  75431  10876     NA  61867  28223     NA</span>
<span class="co">## 354:     NA     NA     NA 216380 128925     NA     NA  84299  14936     NA</span>
<span class="co">## 355:     NA     NA     NA 162256 112923     NA     NA  42586  51588     NA</span>
<span class="co">## 356:     NA     NA     NA 137705 112636     NA     NA  89283  23515  10619</span>
<span class="co">##      M43130</span>
<span class="co">##   1:     NA</span>
<span class="co">##   2:     NA</span>
<span class="co">##   3:     NA</span>
<span class="co">##   4:     NA</span>
<span class="co">##   5:     NA</span>
<span class="co">##  ---       </span>
<span class="co">## 352:     NA</span>
<span class="co">## 353:  16573</span>
<span class="co">## 354:     NA</span>
<span class="co">## 355:     NA</span>
<span class="co">## 356:     NA</span>
<span class="co">## </span>
<span class="co">## ***  @featureData (ID:  featureID ) ***</span>
<span class="co">##      featureID PATHWAY_SORTORDER                    BIOCHEMICAL SUPER_PATHWAY</span>
<span class="co">##   1:    M43027             800.1 1,11-Undecanedicarboxylic acid         Lipid</span>
<span class="co">##   2:    M11953              1070        1,2-dipalmitoylglycerol         Lipid</span>
<span class="co">##   3:    M38002               986                1,2-propanediol         Lipid</span>
<span class="co">##   4:    M34404              1805           1,3,7-trimethylurate   Xenobiotics</span>
<span class="co">##   5:    M35963               600           1,3-dihydroxyacetone  Carbohydrate</span>
<span class="co">##  ---                                                                         </span>
<span class="co">## 754:    M42912              &lt;NA&gt;                      X - 19436          &lt;NA&gt;</span>
<span class="co">## 755:    M42913              &lt;NA&gt;                      X - 19437          &lt;NA&gt;</span>
<span class="co">## 756:    M42914              &lt;NA&gt;                      X - 19438          &lt;NA&gt;</span>
<span class="co">## 757:    M42927              &lt;NA&gt;                      X - 19451          &lt;NA&gt;</span>
<span class="co">## 758:    M43130              &lt;NA&gt;                      X - 19574          &lt;NA&gt;</span>
<span class="co">##                                           SUB_PATHWAY COMP_ID  PLATFORM</span>
<span class="co">##   1:                        Fatty acid, dicarboxylate   43027 LC/MS Neg</span>
<span class="co">##   2:                                   Diacylglycerol   11953     GC/MS</span>
<span class="co">##   3:                                    Ketone bodies   38002     GC/MS</span>
<span class="co">##   4:                              Xanthine metabolism   34404 LC/MS Neg</span>
<span class="co">##   5: Glycolysis, gluconeogenesis, pyruvate metabolism   35963     GC/MS</span>
<span class="co">##  ---                                                                   </span>
<span class="co">## 754:                                             &lt;NA&gt;   42912 LC/MS Neg</span>
<span class="co">## 755:                                             &lt;NA&gt;   42913 LC/MS Neg</span>
<span class="co">## 756:                                             &lt;NA&gt;   42914 LC/MS Neg</span>
<span class="co">## 757:                                             &lt;NA&gt;   42927 LC/MS Neg</span>
<span class="co">## 758:                                             &lt;NA&gt;   43130 LC/MS Neg</span>
<span class="co">##                      RI               MASS PUBCHEM                 CAS   KEGG</span>
<span class="co">##   1:               3578              243.2   10458           505-52-2;   &lt;NA&gt;</span>
<span class="co">##   2:               2600                145   99931         40290-32-2;   &lt;NA&gt;</span>
<span class="co">##   3:               1041                117    &lt;NA&gt;            57-55-6; C00583</span>
<span class="co">##   4:               1988              209.1   79437          5415-44-1; C16361</span>
<span class="co">##   5:               1263                103     670 96-26-4;62147-49-3; C00184</span>
<span class="co">##  ---                                                                         </span>
<span class="co">## 754:               4747              467.4    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span>
<span class="co">## 755: 1150.0999999999999              397.1    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span>
<span class="co">## 756:             1222.3              217.1    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span>
<span class="co">## 757:             3728.5              239.1    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span>
<span class="co">## 758:             4045.7 307.10000000000002    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;</span>
<span class="co">##        HMDb_ID COMP_IDstr</span>
<span class="co">##   1: HMDB02327     M43027</span>
<span class="co">##   2: HMDB07098     M11953</span>
<span class="co">##   3: HMDB01881     M38002</span>
<span class="co">##   4: HMDB02123     M34404</span>
<span class="co">##   5: HMDB01882     M35963</span>
<span class="co">##  ---                     </span>
<span class="co">## 754:      &lt;NA&gt;     M42912</span>
<span class="co">## 755:      &lt;NA&gt;     M42913</span>
<span class="co">## 756:      &lt;NA&gt;     M42914</span>
<span class="co">## 757:      &lt;NA&gt;     M42927</span>
<span class="co">## 758:      &lt;NA&gt;     M43130</span>
<span class="co">## </span>
<span class="co">## ***  @sampleData (ID:  sampleID ) ***</span>
<span class="co">##       sampleID      AGE GENDER      BMI ETHNICITY T2D</span>
<span class="co">##   1: QMDiab222 34.50513      0 25.01021         2   0</span>
<span class="co">##   2: QMDiab113 47.06639      1 28.36776         3   0</span>
<span class="co">##   3:  QMDiab29 55.49076      1 29.70564         1   0</span>
<span class="co">##   4: QMDiab243 56.33402      1 23.14050         2   0</span>
<span class="co">##   5: QMDiab270 35.63039      1 30.06229         1   0</span>
<span class="co">##  ---                                                 </span>
<span class="co">## 352: QMDiab352 41.55510      1 31.22690         3   1</span>
<span class="co">## 353: QMDiab135 52.55305      0 29.07577         2   1</span>
<span class="co">## 354: QMDiab229 30.31348      0 22.22656         2   0</span>
<span class="co">## 355: QMDiab202 49.40999      1 33.72008         1   1</span>
<span class="co">## 356: QMDiab103 23.85489      0 35.96389         1   0</span>
<span class="co">## </span>
<span class="co">## ***  @miscData  ***</span>
<span class="co">## integer(0)</span>
<span class="co">## </span>
<span class="co">## ***  @logs  ***</span>
<span class="co">## 19/08/22 11:30:55: Import data from: /private/var/folders/mj/lsf2tqcx13d5tgl627mm9fxm0000gn/T/RtmpZ5htRD/temp_libpath862b4f79a4da/metabolomicsR/extdata/QMDiab_metabolomics_OrigScale.xlsx .</span>
<span class="co">## 19/08/22 11:30:55: Initiate data: 356 samples and 758 features.</span>
<span class="co">## 19/08/22 11:30:55: Update data, action: change_featureID, 356 samples and 758 features.</span></code></pre>
</details><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load urine metabolomic data</span>
<span class="va">df_urine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_excel.html">load_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">file_path</span>,
                        data_sheet <span class="op">=</span> <span class="fl">2</span>,
                        feature_sheet <span class="op">=</span> <span class="fl">5</span>,
                        sample_sheet <span class="op">=</span> <span class="fl">9</span>,
                        sampleID <span class="op">=</span> <span class="st">"QMDiab-ID"</span>,
                        featureID <span class="op">=</span> <span class="st">"BIOCHEMICAL"</span>
                        <span class="op">)</span>

<span class="va">df_urine</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/update_Metabolite.html">update_Metabolite</a></span><span class="op">(</span><span class="va">df_urine</span>, dataset <span class="op">=</span> <span class="st">"COMP_IDstr"</span>, action <span class="op">=</span> <span class="st">"change_featureID"</span><span class="op">)</span></code></pre></div>
<p><br></p>
<details><summary><strong>click to show urine data</strong>
</summary><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_urine</span></code></pre></div>
<pre><code><span class="co">## An object of  Metabolite </span>
<span class="co">## </span>
<span class="co">## ***  @assayData (first and last 10 columns [ 359  *  892 ])  ***</span>
<span class="co">##       sampleID   M38002 M34404  M32391 M20675   M21049  M34400 M40506  M34455</span>
<span class="co">##   1: QMDiab254  1189337 146900  265120  53499 15379982  619745  53261  227263</span>
<span class="co">##   2: QMDiab290  9944836 716781 2042008  71989 26406420 1988553 123129 1221563</span>
<span class="co">##   3:  QMDiab54   926350 182438  775726  48752  7551248 1159521  72837  215868</span>
<span class="co">##   4:  QMDiab55   305459 579097  511122  21423  4655848 1102500 131674      NA</span>
<span class="co">##   5: QMDiab319   574761 295176  175826  91788  2762680  417870  21631  243512</span>
<span class="co">##  ---                                                                         </span>
<span class="co">## 355:  QMDiab70  1139559 117975  326903     NA 10051449  406266 234997  183234</span>
<span class="co">## 356: QMDiab118  1517228 234288      NA  24350  2613189  375914  51929      NA</span>
<span class="co">## 357:  QMDiab65  1028291 352068  609710 113673 29650920  621166 130037  549992</span>
<span class="co">## 358: QMDiab248  1807105 338741  148964  62614   937893  603113  48151  293379</span>
<span class="co">## 359:   QMDiab4 10103832 203176  245175  50822 28406416  243598  74996  696766</span>
<span class="co">##        M30460 M42272 M42314 M42335 M42351 M42352 M42553 M42856 M42913 M43112</span>
<span class="co">##   1:  5502123  96913  31056  33430     NA  35558     NA  23369  21931     NA</span>
<span class="co">##   2: 17475172 124745  66036  39595     NA 732853     NA  28220  27811     NA</span>
<span class="co">##   3:  6423459  44266  23363  39645     NA  62630     NA  13148  25018     NA</span>
<span class="co">##   4:  4246983  77365  40193  46686     NA  92981     NA  22845  23620     NA</span>
<span class="co">##   5:  2780633  24081  16319  25583     NA  31037     NA  29122  41337     NA</span>
<span class="co">##  ---                                                                        </span>
<span class="co">## 355:  1407294  54919  52317  78413     NA  38453     NA  33084 195136     NA</span>
<span class="co">## 356:  1856043  42309  17973  25751     NA  12967     NA  15268  31577     NA</span>
<span class="co">## 357: 10131966 110335  40228  34299     NA 108341     NA  52714  33244     NA</span>
<span class="co">## 358:       NA  36055  29644  22465     NA  19287     NA  27299  36462     NA</span>
<span class="co">## 359: 27087992 185546  45205  60944     NA 149210   9804  35991 186372     NA</span>
<span class="co">##      M43129 M43130</span>
<span class="co">##   1:     NA     NA</span>
<span class="co">##   2:     NA   7215</span>
<span class="co">##   3:     NA   8596</span>
<span class="co">##   4:     NA     NA</span>
<span class="co">##   5:     NA     NA</span>
<span class="co">##  ---              </span>
<span class="co">## 355:     NA   5700</span>
<span class="co">## 356:     NA  11083</span>
<span class="co">## 357:     NA   6296</span>
<span class="co">## 358:     NA     NA</span>
<span class="co">## 359:     NA   7482</span>
<span class="co">## </span>
<span class="co">## ***  @featureData (ID:  featureID ) ***</span>
<span class="co">##      featureID PATHWAY_SORTORDER                  BIOCHEMICAL SUPER_PATHWAY</span>
<span class="co">##   1:    M38002               986              1,2-propanediol         Lipid</span>
<span class="co">##   2:    M34404              1805         1,3,7-trimethylurate   Xenobiotics</span>
<span class="co">##   3:    M32391              1802            1,3-dimethylurate   Xenobiotics</span>
<span class="co">##   4:    M20675               583 1,5-anhydroglucitol (1,5-AG)  Carbohydrate</span>
<span class="co">##   5:    M21049               591           1,6-anhydroglucose  Carbohydrate</span>
<span class="co">##  ---                                                                       </span>
<span class="co">## 887:    M42856              &lt;NA&gt;                    X - 19380          &lt;NA&gt;</span>
<span class="co">## 888:    M42913              &lt;NA&gt;                    X - 19437          &lt;NA&gt;</span>
<span class="co">## 889:    M43112              &lt;NA&gt;                    X - 19556          &lt;NA&gt;</span>
<span class="co">## 890:    M43129              &lt;NA&gt;                    X - 19573          &lt;NA&gt;</span>
<span class="co">## 891:    M43130              &lt;NA&gt;                    X - 19574          &lt;NA&gt;</span>
<span class="co">##                                           SUB_PATHWAY COMP_ID  PLATFORM</span>
<span class="co">##   1:                                    Ketone bodies   38002     GC/MS</span>
<span class="co">##   2:                              Xanthine metabolism   34404 LC/MS Neg</span>
<span class="co">##   3:                              Xanthine metabolism   32391     GC/MS</span>
<span class="co">##   4: Glycolysis, gluconeogenesis, pyruvate metabolism   20675 LC/MS Neg</span>
<span class="co">##   5: Glycolysis, gluconeogenesis, pyruvate metabolism   21049     GC/MS</span>
<span class="co">##  ---                                                                   </span>
<span class="co">## 887:                                             &lt;NA&gt;   42856 LC/MS Neg</span>
<span class="co">## 888:                                             &lt;NA&gt;   42913 LC/MS Neg</span>
<span class="co">## 889:                                             &lt;NA&gt;   43112 LC/MS Pos</span>
<span class="co">## 890:                                             &lt;NA&gt;   43129 LC/MS Neg</span>
<span class="co">## 891:                                             &lt;NA&gt;   43130 LC/MS Neg</span>
<span class="co">##                      RI               MASS  PUBCHEM        CAS   KEGG   HMDb_ID</span>
<span class="co">##   1:               1041                117     &lt;NA&gt;   57-55-6; C00583 HMDB01881</span>
<span class="co">##   2:               1988              209.1    79437 5415-44-1; C16361 HMDB02123</span>
<span class="co">##   3:               1937 325.10000000000002    70346 944-73-0 ;   &lt;NA&gt; HMDB01857</span>
<span class="co">##   4:                808 163.19999999999999     &lt;NA&gt;  154-58-5; C07326 HMDB02712</span>
<span class="co">##   5:             1679.5              204.1 11412545  498-07-7;   &lt;NA&gt; HMDB00640</span>
<span class="co">##  ---                                                                           </span>
<span class="co">## 887:               2287              412.4     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 888: 1150.0999999999999              397.1     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 889: 4249.8999999999996              404.9     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 890:             3906.5              403.2     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 891:             4045.7 307.10000000000002     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">##      COMP_IDstr</span>
<span class="co">##   1:     M38002</span>
<span class="co">##   2:     M34404</span>
<span class="co">##   3:     M32391</span>
<span class="co">##   4:     M20675</span>
<span class="co">##   5:     M21049</span>
<span class="co">##  ---           </span>
<span class="co">## 887:     M42856</span>
<span class="co">## 888:     M42913</span>
<span class="co">## 889:     M43112</span>
<span class="co">## 890:     M43129</span>
<span class="co">## 891:     M43130</span>
<span class="co">## </span>
<span class="co">## ***  @sampleData (ID:  sampleID ) ***</span>
<span class="co">##       sampleID      AGE GENDER      BMI ETHNICITY T2D</span>
<span class="co">##   1: QMDiab254 53.10335      0 32.05128         1   0</span>
<span class="co">##   2: QMDiab290 39.79192      1 30.51426         4   0</span>
<span class="co">##   3:  QMDiab54 36.82136      0 24.16831         1   0</span>
<span class="co">##   4:  QMDiab55 34.75975      0 44.44444         1   1</span>
<span class="co">##   5: QMDiab319 50.17933      1 27.18090         1   1</span>
<span class="co">##  ---                                                 </span>
<span class="co">## 355:  QMDiab70 35.40315      1 33.83403         1   1</span>
<span class="co">## 356: QMDiab118 49.06229      1 25.64494         1   0</span>
<span class="co">## 357:  QMDiab65 47.22245      1 23.38435         1   0</span>
<span class="co">## 358: QMDiab248 56.39151      0 27.58621         1   1</span>
<span class="co">## 359:   QMDiab4 24.22450      0 41.66521         1   0</span>
<span class="co">## </span>
<span class="co">## ***  @miscData  ***</span>
<span class="co">## integer(0)</span>
<span class="co">## </span>
<span class="co">## ***  @logs  ***</span>
<span class="co">## 19/08/22 11:30:56: Import data from: /private/var/folders/mj/lsf2tqcx13d5tgl627mm9fxm0000gn/T/RtmpZ5htRD/temp_libpath862b4f79a4da/metabolomicsR/extdata/QMDiab_metabolomics_OrigScale.xlsx .</span>
<span class="co">## 19/08/22 11:30:56: Initiate data: 359 samples and 891 features.</span>
<span class="co">## 19/08/22 11:30:56: Update data, action: change_featureID, 359 samples and 891 features.</span></code></pre>
</details><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load saliva metatabolomic data</span>
<span class="va">df_saliva</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_excel.html">load_excel</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">file_path</span>,
                        data_sheet <span class="op">=</span> <span class="fl">3</span>,
                        feature_sheet <span class="op">=</span> <span class="fl">6</span>,
                        sample_sheet <span class="op">=</span> <span class="fl">10</span>,
                        sampleID <span class="op">=</span> <span class="st">"QMDiab-ID"</span>,
                        featureID <span class="op">=</span> <span class="st">"BIOCHEMICAL"</span>
                        <span class="op">)</span>

<span class="va">df_saliva</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/update_Metabolite.html">update_Metabolite</a></span><span class="op">(</span><span class="va">df_saliva</span>, dataset <span class="op">=</span> <span class="st">"COMP_IDstr"</span>, action <span class="op">=</span> <span class="st">"change_featureID"</span><span class="op">)</span></code></pre></div>
<br><details><summary><strong>click to show saliva data</strong>
</summary><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_saliva</span></code></pre></div>
<pre><code><span class="co">## An object of  Metabolite </span>
<span class="co">## </span>
<span class="co">## ***  @assayData (first and last 10 columns [ 321  *  603 ])  ***</span>
<span class="co">##       sampleID M43027  M38002 M01654 M35963 M35690 M20675 M21049 M34400 M35628</span>
<span class="co">##   1: QMDiab370  11974  720004     NA     NA  91544 211457     NA   2661     NA</span>
<span class="co">##   2: QMDiab245  15485  481889  24313  53097  80819 175312  25921   2250  27847</span>
<span class="co">##   3:  QMDiab34  13916  979243     NA  44158 104042 271930     NA     NA     NA</span>
<span class="co">##   4: QMDiab287  28023  825577     NA  57600 157057  50692     NA     NA     NA</span>
<span class="co">##   5: QMDiab355  22830 1150408     NA  63460 225965 741408  71523   3739     NA</span>
<span class="co">##  ---                                                                          </span>
<span class="co">## 317: QMDiab202  16493  488210     NA     NA 116683 158562     NA   3496  18241</span>
<span class="co">## 318:  QMDiab80  15254 3345272  23456  36201 120444 295726 107821     NA  14988</span>
<span class="co">## 319: QMDiab107  31452  578446     NA  20563 245882 234635     NA     NA     NA</span>
<span class="co">## 320: QMDiab352  18975  280464     NA     NA  20491  77539     NA     NA  19239</span>
<span class="co">## 321: QMDiab127  16344  881910  64403  44381 206525 912153     NA     NA  12066</span>
<span class="co">##      M42851 M42877 M42913 M42914 M43042 M43049 M43050 M43110 M43122 M43128</span>
<span class="co">##   1:   4937     NA   5390     NA  22149   4997   5548     NA     NA  14190</span>
<span class="co">##   2:   3316     NA  10883   1110  22797   8284     NA     NA     NA  15273</span>
<span class="co">##   3:   3260     NA     NA     NA  15291     NA     NA     NA     NA  10602</span>
<span class="co">##   4:   3463     NA   6735     NA  20655   5779     NA     NA     NA  13165</span>
<span class="co">##   5:   3887     NA   3670     NA  45619   6922     NA  12023     NA  15046</span>
<span class="co">##  ---                                                                      </span>
<span class="co">## 317:     NA     NA   7243     NA  14632     NA     NA     NA     NA  15163</span>
<span class="co">## 318:     NA     NA  10592   3708  15018   5433     NA     NA     NA  21337</span>
<span class="co">## 319:     NA     NA     NA   4409  37399   9265     NA  42065     NA  37183</span>
<span class="co">## 320:     NA     NA   9140   4056   3362     NA     NA     NA     NA  21376</span>
<span class="co">## 321:     NA   2645   7590   4894  25546   5422     NA     NA     NA  15142</span>
<span class="co">##      M43137</span>
<span class="co">##   1:     NA</span>
<span class="co">##   2:     NA</span>
<span class="co">##   3:     NA</span>
<span class="co">##   4:     NA</span>
<span class="co">##   5:     NA</span>
<span class="co">##  ---       </span>
<span class="co">## 317:     NA</span>
<span class="co">## 318:     NA</span>
<span class="co">## 319:     NA</span>
<span class="co">## 320:     NA</span>
<span class="co">## 321:     NA</span>
<span class="co">## </span>
<span class="co">## ***  @featureData (ID:  featureID ) ***</span>
<span class="co">##      featureID PATHWAY_SORTORDER                BIOCHEMICAL SUPER_PATHWAY</span>
<span class="co">##   1:    M43027             800.1 1,11-undecanedicarboxylate         Lipid</span>
<span class="co">##   2:    M38002               986            1,2-propanediol         Lipid</span>
<span class="co">##   3:    M01654               273         1,3-diaminopropane    Amino acid</span>
<span class="co">##   4:    M35963               600       1,3-dihydroxyacetone  Carbohydrate</span>
<span class="co">##   5:    M35690              1494             1,4-butanediol   Xenobiotics</span>
<span class="co">##  ---                                                                     </span>
<span class="co">## 598:    M43050              &lt;NA&gt;                  X - 19497          &lt;NA&gt;</span>
<span class="co">## 599:    M43110              &lt;NA&gt;                  X - 19554          &lt;NA&gt;</span>
<span class="co">## 600:    M43122              &lt;NA&gt;                  X - 19566          &lt;NA&gt;</span>
<span class="co">## 601:    M43128              &lt;NA&gt;                  X - 19572          &lt;NA&gt;</span>
<span class="co">## 602:    M43137              &lt;NA&gt;                  X - 19581          &lt;NA&gt;</span>
<span class="co">##                                           SUB_PATHWAY COMP_ID  PLATFORM</span>
<span class="co">##   1:                        Fatty acid, dicarboxylate   43027 LC/MS Neg</span>
<span class="co">##   2:                                    Ketone bodies   38002     GC/MS</span>
<span class="co">##   3:      Urea cycle; arginine-, proline-, metabolism    1654     GC/MS</span>
<span class="co">##   4: Glycolysis, gluconeogenesis, pyruvate metabolism   35963     GC/MS</span>
<span class="co">##   5:                                         Chemical   35690     GC/MS</span>
<span class="co">##  ---                                                                   </span>
<span class="co">## 598:                                             &lt;NA&gt;   43050 LC/MS Neg</span>
<span class="co">## 599:                                             &lt;NA&gt;   43110 LC/MS Pos</span>
<span class="co">## 600:                                             &lt;NA&gt;   43122 LC/MS Neg</span>
<span class="co">## 601:                                             &lt;NA&gt;   43128 LC/MS Neg</span>
<span class="co">## 602:                                             &lt;NA&gt;   43137 LC/MS Neg</span>
<span class="co">##                      RI  MASS PUBCHEM                 CAS   KEGG   HMDb_ID</span>
<span class="co">##   1:               3578 243.2   10458           505-52-2;   &lt;NA&gt; HMDB02327</span>
<span class="co">##   2:               1041   117    &lt;NA&gt;            57-55-6; C00583 HMDB01881</span>
<span class="co">##   3:             1633.8   174     428           109-76-2; C00986 HMDB00002</span>
<span class="co">##   4:               1263   103     670 96-26-4;62147-49-3; C00184 HMDB01882</span>
<span class="co">##   5:               1208 115.8    &lt;NA&gt;           110-63-4;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">##  ---                                                                      </span>
<span class="co">## 598:             3657.6 227.3    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 599:             3618.7   471    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 600:             2953.2 744.5    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 601:             3761.2 431.3    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 602: 4949.6000000000004 938.5    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">##      COMP_IDstr</span>
<span class="co">##   1:     M43027</span>
<span class="co">##   2:     M38002</span>
<span class="co">##   3:     M01654</span>
<span class="co">##   4:     M35963</span>
<span class="co">##   5:     M35690</span>
<span class="co">##  ---           </span>
<span class="co">## 598:     M43050</span>
<span class="co">## 599:     M43110</span>
<span class="co">## 600:     M43122</span>
<span class="co">## 601:     M43128</span>
<span class="co">## 602:     M43137</span>
<span class="co">## </span>
<span class="co">## ***  @sampleData (ID:  sampleID ) ***</span>
<span class="co">##       sampleID      AGE GENDER      BMI ETHNICITY T2D</span>
<span class="co">##   1: QMDiab370 56.49829      1 25.76591         1   1</span>
<span class="co">##   2: QMDiab245 51.51540      0 23.89943         1   0</span>
<span class="co">##   3:  QMDiab34 28.00548      0 23.90118         3   0</span>
<span class="co">##   4: QMDiab287 41.43463      0 31.47107         4   1</span>
<span class="co">##   5: QMDiab355 28.34771      0 25.16103         1   0</span>
<span class="co">##  ---                                                 </span>
<span class="co">## 317: QMDiab202 49.40999      1 33.72008         1   1</span>
<span class="co">## 318:  QMDiab80 25.86995      0 29.89101         1   0</span>
<span class="co">## 319: QMDiab107 38.50240      1 24.60973         2   0</span>
<span class="co">## 320: QMDiab352 41.55510      1 31.22690         3   1</span>
<span class="co">## 321: QMDiab127 34.69952      1 30.47797         1   0</span>
<span class="co">## </span>
<span class="co">## ***  @miscData  ***</span>
<span class="co">## integer(0)</span>
<span class="co">## </span>
<span class="co">## ***  @logs  ***</span>
<span class="co">## 19/08/22 11:30:56: Import data from: /private/var/folders/mj/lsf2tqcx13d5tgl627mm9fxm0000gn/T/RtmpZ5htRD/temp_libpath862b4f79a4da/metabolomicsR/extdata/QMDiab_metabolomics_OrigScale.xlsx .</span>
<span class="co">## 19/08/22 11:30:56: Initiate data: 321 samples and 602 features.</span>
<span class="co">## 19/08/22 11:30:56: Update data, action: change_featureID, 321 samples and 602 features.</span></code></pre>
</details><p><br><br></p>
</div>
<div class="section level2">
<h2 id="quality-control-pipeline">Quality control pipeline<a class="anchor" aria-label="anchor" href="#quality-control-pipeline"></a>
</h2>
<p>We provided a pipeline for metabolite and sample quality control (QC)
procedures. In the QC pipeline, we included the following functions:
remove metabolites or samples beyond a particular missing rate threshold
(e.g., 0.5), detect outliers (e.g., ± 5 standard deviations) and replace
outliers with missing values or winsorize outliers, and various popular
methods to impute missing values (e.g., half of the minimum value,
median, zero, or nearest neighbor averaging [kNN] method). All the steps
can be customized that have been implemented in the “QC_pipeline”
function or be used from each individual function (eg.
“filter_column_missing_rate”, “replace_outlier”, and “impute”).</p>
<p>First, we display the QC metrics using the <code>{plot_QC}</code>
function</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_QC.html">plot_QC</a></span><span class="op">(</span><span class="va">df_plasma</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="va">p</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-9-1.png" width="1536"></p>
<details><summary><strong>click to show plasma QC metrics</strong>
</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span></code></pre></div>
<pre><code><span class="co">## $column_constant</span>
<span class="co">##          ID     x</span>
<span class="co">##   1: M43027 FALSE</span>
<span class="co">##   2: M11953 FALSE</span>
<span class="co">##   3: M38002 FALSE</span>
<span class="co">##   4: M34404 FALSE</span>
<span class="co">##   5: M35963 FALSE</span>
<span class="co">##  ---             </span>
<span class="co">## 754: M42912  TRUE</span>
<span class="co">## 755: M42913 FALSE</span>
<span class="co">## 756: M42914 FALSE</span>
<span class="co">## 757: M42927 FALSE</span>
<span class="co">## 758: M43130 FALSE</span>
<span class="co">## </span>
<span class="co">## $column_missing_rate</span>
<span class="co">##          ID           x</span>
<span class="co">##   1: M43027 0.151685393</span>
<span class="co">##   2: M11953 0.146067416</span>
<span class="co">##   3: M38002 0.056179775</span>
<span class="co">##   4: M34404 0.036516854</span>
<span class="co">##   5: M35963 0.081460674</span>
<span class="co">##  ---                   </span>
<span class="co">## 754: M42912 0.997191011</span>
<span class="co">## 755: M42913 0.000000000</span>
<span class="co">## 756: M42914 0.005617978</span>
<span class="co">## 757: M42927 0.764044944</span>
<span class="co">## 758: M43130 0.949438202</span>
<span class="co">## </span>
<span class="co">## $row_missing_rate</span>
<span class="co">##             ID         x</span>
<span class="co">##   1: QMDiab222 0.3588391</span>
<span class="co">##   2: QMDiab113 0.2968338</span>
<span class="co">##   3:  QMDiab29 0.2862797</span>
<span class="co">##   4: QMDiab243 0.2572559</span>
<span class="co">##   5: QMDiab270 0.3680739</span>
<span class="co">##  ---                    </span>
<span class="co">## 352: QMDiab352 0.2902375</span>
<span class="co">## 353: QMDiab135 0.3007916</span>
<span class="co">## 354: QMDiab229 0.3284960</span>
<span class="co">## 355: QMDiab202 0.3021108</span>
<span class="co">## 356: QMDiab103 0.3034301</span>
<span class="co">## </span>
<span class="co">## $outlier_rate</span>
<span class="co">##          ID           x</span>
<span class="co">##   1: M43027 0.006622517</span>
<span class="co">##   2: M11953 0.000000000</span>
<span class="co">##   3: M38002 0.011904762</span>
<span class="co">##   4: M34404 0.005830904</span>
<span class="co">##   5: M35963 0.000000000</span>
<span class="co">##  ---                   </span>
<span class="co">## 754: M42912         NaN</span>
<span class="co">## 755: M42913 0.000000000</span>
<span class="co">## 756: M42914 0.008474576</span>
<span class="co">## 757: M42927 0.000000000</span>
<span class="co">## 758: M43130 0.000000000</span>
<span class="co">## </span>
<span class="co">## $p</span></code></pre>
<img src="Introduction_files/figure-html/unnamed-chunk-10-1.png" width="700"></details><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_plasma_QC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/QC_pipeline.html">QC_pipeline</a></span><span class="op">(</span><span class="va">df_plasma</span>, replace_outlier_method <span class="op">=</span> <span class="st">"winsorize"</span>, impute_method <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co"><span style="color: #00BB00;">## Constant columns n = 37</span></span>
<span class="co"><span style="color: #00BB00;">## </span></span>
<span class="co"><span style="color: #00BB00;">## Number of columns with a missing rate &gt;= 0.5 : n = 176</span></span>
<span class="co"><span style="color: #00BB00;">## </span></span></code></pre>
<details><summary><strong>click to show plasma data after QC</strong>
</summary><div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_plasma_QC</span></code></pre></div>
<pre><code><span class="co">## An object of  Metabolite </span>
<span class="co">## </span>
<span class="co">## ***  @assayData (first and last 10 columns [ 356  *  546 ])  ***</span>
<span class="co">##       sampleID M43027 M11953 M38002 M34404 M35963 M35728 M20675 M34400  M33228</span>
<span class="co">##   1: QMDiab222   8578     NA 103724  22259 104059   7067 357499  19986 2173598</span>
<span class="co">##   2: QMDiab113  15145     NA     NA  39841     NA  36542 440058  16620 2464846</span>
<span class="co">##   3:  QMDiab29     NA  96455 159945  10605 165416  54209 355790  12220 2613798</span>
<span class="co">##   4: QMDiab243  19692  69444 108965  38562 139866  22412 185273  29537 2543266</span>
<span class="co">##   5: QMDiab270     NA     NA 157617   4490     NA  21958 692753  10256 2138029</span>
<span class="co">##  ---                                                                          </span>
<span class="co">## 352: QMDiab352   6689 116932 115737  34791 152711  59120 178759  25326  864647</span>
<span class="co">## 353: QMDiab135   7556 248824 481008   4766 164853 126065 103647  12253 3018611</span>
<span class="co">## 354: QMDiab229  20252  80804 138253  13949  85019  43072 330579  15124 1398965</span>
<span class="co">## 355: QMDiab202   7378 108152 112229  21748 175918  78154 106745  21434 2104899</span>
<span class="co">## 356: QMDiab103   6667  57851 146948   8458  82064  34234 534697  12979  992388</span>
<span class="co">##      M42307 M42314 M42544 M42548 M42549 M42552 M42554 M42856 M42887 M42913</span>
<span class="co">##   1:     NA  30592   3839  13734     NA     NA  37654 158054  88569  64644</span>
<span class="co">##   2:   6978  81380   4128  15288     NA   4697  28262 125669  87268  52074</span>
<span class="co">##   3:  17943 104253   6788  18861   6761   5096  30139 194732 106360  31782</span>
<span class="co">##   4:  11069  73203   8493  12138  10371  11207  21406 152853 119643  67713</span>
<span class="co">##   5:   7904  28846   7130  12843   3150   4556  14976 204978 149644 108660</span>
<span class="co">##  ---                                                                      </span>
<span class="co">## 352:  11539  40487   9988   6173   7678   9008  30501 195331 134564  22141</span>
<span class="co">## 353:   5441  37950     NA  18464     NA     NA  43687 136120  75431  61867</span>
<span class="co">## 354:     NA  18098   5766   8244   5932     NA  18728 216380 128925  84299</span>
<span class="co">## 355:   8119  70566   8470  11932     NA   5895  27858 162256 112923  42586</span>
<span class="co">## 356:   7647  46836   7420   8019     NA   8253  32159 137705 112636  89283</span>
<span class="co">##      M42914</span>
<span class="co">##   1:  18055</span>
<span class="co">##   2:  12805</span>
<span class="co">##   3:  18467</span>
<span class="co">##   4:  12356</span>
<span class="co">##   5:  12479</span>
<span class="co">##  ---       </span>
<span class="co">## 352:  17205</span>
<span class="co">## 353:  28223</span>
<span class="co">## 354:  14936</span>
<span class="co">## 355:  51588</span>
<span class="co">## 356:  23515</span>
<span class="co">## </span>
<span class="co">## ***  @featureData (ID:  featureID ) ***</span>
<span class="co">##      featureID PATHWAY_SORTORDER                    BIOCHEMICAL SUPER_PATHWAY</span>
<span class="co">##   1:    M43027             800.1 1,11-Undecanedicarboxylic acid         Lipid</span>
<span class="co">##   2:    M11953              1070        1,2-dipalmitoylglycerol         Lipid</span>
<span class="co">##   3:    M38002               986                1,2-propanediol         Lipid</span>
<span class="co">##   4:    M34404              1805           1,3,7-trimethylurate   Xenobiotics</span>
<span class="co">##   5:    M35963               600           1,3-dihydroxyacetone  Carbohydrate</span>
<span class="co">##  ---                                                                         </span>
<span class="co">## 541:    M42554              &lt;NA&gt;                      X - 19147          &lt;NA&gt;</span>
<span class="co">## 542:    M42856              &lt;NA&gt;                      X - 19380          &lt;NA&gt;</span>
<span class="co">## 543:    M42887              &lt;NA&gt;                      X - 19411          &lt;NA&gt;</span>
<span class="co">## 544:    M42913              &lt;NA&gt;                      X - 19437          &lt;NA&gt;</span>
<span class="co">## 545:    M42914              &lt;NA&gt;                      X - 19438          &lt;NA&gt;</span>
<span class="co">##                                           SUB_PATHWAY COMP_ID  PLATFORM</span>
<span class="co">##   1:                        Fatty acid, dicarboxylate   43027 LC/MS Neg</span>
<span class="co">##   2:                                   Diacylglycerol   11953     GC/MS</span>
<span class="co">##   3:                                    Ketone bodies   38002     GC/MS</span>
<span class="co">##   4:                              Xanthine metabolism   34404 LC/MS Neg</span>
<span class="co">##   5: Glycolysis, gluconeogenesis, pyruvate metabolism   35963     GC/MS</span>
<span class="co">##  ---                                                                   </span>
<span class="co">## 541:                                             &lt;NA&gt;   42554 LC/MS Neg</span>
<span class="co">## 542:                                             &lt;NA&gt;   42856 LC/MS Neg</span>
<span class="co">## 543:                                             &lt;NA&gt;   42887 LC/MS Neg</span>
<span class="co">## 544:                                             &lt;NA&gt;   42913 LC/MS Neg</span>
<span class="co">## 545:                                             &lt;NA&gt;   42914 LC/MS Neg</span>
<span class="co">##                      RI  MASS PUBCHEM                 CAS   KEGG   HMDb_ID</span>
<span class="co">##   1:               3578 243.2   10458           505-52-2;   &lt;NA&gt; HMDB02327</span>
<span class="co">##   2:               2600   145   99931         40290-32-2;   &lt;NA&gt; HMDB07098</span>
<span class="co">##   3:               1041   117    &lt;NA&gt;            57-55-6; C00583 HMDB01881</span>
<span class="co">##   4:               1988 209.1   79437          5415-44-1; C16361 HMDB02123</span>
<span class="co">##   5:               1263   103     670 96-26-4;62147-49-3; C00184 HMDB01882</span>
<span class="co">##  ---                                                                      </span>
<span class="co">## 541: 4730.8999999999996 283.3    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 542:               2287 412.4    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 543:               1308 383.3    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 544: 1150.0999999999999 397.1    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 545:             1222.3 217.1    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">##      COMP_IDstr</span>
<span class="co">##   1:     M43027</span>
<span class="co">##   2:     M11953</span>
<span class="co">##   3:     M38002</span>
<span class="co">##   4:     M34404</span>
<span class="co">##   5:     M35963</span>
<span class="co">##  ---           </span>
<span class="co">## 541:     M42554</span>
<span class="co">## 542:     M42856</span>
<span class="co">## 543:     M42887</span>
<span class="co">## 544:     M42913</span>
<span class="co">## 545:     M42914</span>
<span class="co">## </span>
<span class="co">## ***  @sampleData (ID:  sampleID ) ***</span>
<span class="co">##       sampleID      AGE GENDER      BMI ETHNICITY T2D</span>
<span class="co">##   1: QMDiab222 34.50513      0 25.01021         2   0</span>
<span class="co">##   2: QMDiab113 47.06639      1 28.36776         3   0</span>
<span class="co">##   3:  QMDiab29 55.49076      1 29.70564         1   0</span>
<span class="co">##   4: QMDiab243 56.33402      1 23.14050         2   0</span>
<span class="co">##   5: QMDiab270 35.63039      1 30.06229         1   0</span>
<span class="co">##  ---                                                 </span>
<span class="co">## 352: QMDiab352 41.55510      1 31.22690         3   1</span>
<span class="co">## 353: QMDiab135 52.55305      0 29.07577         2   1</span>
<span class="co">## 354: QMDiab229 30.31348      0 22.22656         2   0</span>
<span class="co">## 355: QMDiab202 49.40999      1 33.72008         1   1</span>
<span class="co">## 356: QMDiab103 23.85489      0 35.96389         1   0</span>
<span class="co">## </span>
<span class="co">## ***  @miscData  ***</span>
<span class="co">## integer(0)</span>
<span class="co">## </span>
<span class="co">## ***  @logs  ***</span>
<span class="co">## 19/08/22 11:30:55: Import data from: /private/var/folders/mj/lsf2tqcx13d5tgl627mm9fxm0000gn/T/RtmpZ5htRD/temp_libpath862b4f79a4da/metabolomicsR/extdata/QMDiab_metabolomics_OrigScale.xlsx .</span>
<span class="co">## 19/08/22 11:30:55: Initiate data: 356 samples and 758 features.</span>
<span class="co">## 19/08/22 11:30:55: Update data, action: change_featureID, 356 samples and 758 features. </span>
<span class="co">## </span>
<span class="co">## 19/08/22 11:31:00: Run QC pipeline.</span>
<span class="co">## 19/08/22 11:31:00: Filter data with a constant column, removed 37 features. </span>
<span class="co">## 19/08/22 11:31:00: Update data, action: keep_feature, 356 samples and 721 features. </span>
<span class="co">## 19/08/22 11:31:00: Filter data with a missing rate &gt;= 0.5, removed 175 features. </span>
<span class="co">## 19/08/22 11:31:00: Update data, action: keep_feature, 356 samples and 545 features. </span>
<span class="co">## 19/08/22 11:31:01: Replace outliers using `winsorize` method 5 SDs.</span></code></pre>
</details><p>For the urine QC metrics:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_QC.html">plot_QC</a></span><span class="op">(</span><span class="va">df_urine</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="va">p</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-13-1.png" width="1536"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_urine_QC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/QC_pipeline.html">QC_pipeline</a></span><span class="op">(</span><span class="va">df_urine</span>, replace_outlier_method <span class="op">=</span> <span class="st">"winsorize"</span>, impute_method <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co"><span style="color: #00BB00;">## Constant columns n = 28</span></span>
<span class="co"><span style="color: #00BB00;">## </span></span>
<span class="co"><span style="color: #00BB00;">## Number of columns with a missing rate &gt;= 0.5 : n = 77</span></span>
<span class="co"><span style="color: #00BB00;">## </span></span></code></pre>
<details><summary><strong>click to show urine data after QC</strong>
</summary><div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_urine_QC</span></code></pre></div>
<pre><code><span class="co">## An object of  Metabolite </span>
<span class="co">## </span>
<span class="co">## ***  @assayData (first and last 10 columns [ 359  *  787 ])  ***</span>
<span class="co">##       sampleID   M38002 M34404  M32391 M20675   M21049  M34400 M40506  M34455</span>
<span class="co">##   1: QMDiab254  1189337 146900  265120  53499 15379982  619745  53261  227263</span>
<span class="co">##   2: QMDiab290  9944836 716781 2042008  71989 26406420 1988553 123129 1221563</span>
<span class="co">##   3:  QMDiab54   926350 182438  775726  48752  7551248 1159521  72837  215868</span>
<span class="co">##   4:  QMDiab55   305459 579097  511122  21423  4655848 1102500 131674      NA</span>
<span class="co">##   5: QMDiab319   574761 295176  175826  91788  2762680  417870  21631  243512</span>
<span class="co">##  ---                                                                         </span>
<span class="co">## 355:  QMDiab70  1139559 117975  326903     NA 10051449  406266 234997  183234</span>
<span class="co">## 356: QMDiab118  1517228 234288      NA  24350  2613189  375914  51929      NA</span>
<span class="co">## 357:  QMDiab65  1028291 352068  609710 113673 29650920  621166 130037  549992</span>
<span class="co">## 358: QMDiab248  1807105 338741  148964  62614   937893  603113  48151  293379</span>
<span class="co">## 359:   QMDiab4 10103832 203176  245175  50822 28406416  243598  74996  696766</span>
<span class="co">##        M30460 M41595 M41702 M41709 M41768 M41837 M42272 M42314 M42335 M42352</span>
<span class="co">##   1:  5502123  74988  29007   4223  17008   5636  96913  31056  33430  35558</span>
<span class="co">##   2: 17475172  66278 101935  34251  14937   9552 124745  66036  39595 652059</span>
<span class="co">##   3:  6423459  74225  51295  14090  32971   9104  44266  23363  39645  62630</span>
<span class="co">##   4:  4246983  63809  31054   6151   8054  15148  77365  40193  46686  92981</span>
<span class="co">##   5:  2780633  40804   8307   3715  31370   5993  24081  16319  25583  31037</span>
<span class="co">##  ---                                                                        </span>
<span class="co">## 355:  1407294  67664  36157     NA  29194  15652  54919  52317  78413  38453</span>
<span class="co">## 356:  1856043  34332  29877  30817   5029   4603  42309  17973  25751  12967</span>
<span class="co">## 357: 10131966  57310  22374     NA  19358   9598 110335  40228  34299 108341</span>
<span class="co">## 358:       NA  26670   8525   7059  13231   9698  36055  29644  22465  19287</span>
<span class="co">## 359: 27087992  95140  66285  20229  35845  18570 185546  45205  60944 149210</span>
<span class="co">##      M42856 M42913</span>
<span class="co">##   1:  23369  21931</span>
<span class="co">##   2:  28220  27811</span>
<span class="co">##   3:  13148  25018</span>
<span class="co">##   4:  22845  23620</span>
<span class="co">##   5:  29122  41337</span>
<span class="co">##  ---              </span>
<span class="co">## 355:  33084 195136</span>
<span class="co">## 356:  15268  31577</span>
<span class="co">## 357:  52714  33244</span>
<span class="co">## 358:  27299  36462</span>
<span class="co">## 359:  35991 186372</span>
<span class="co">## </span>
<span class="co">## ***  @featureData (ID:  featureID ) ***</span>
<span class="co">##      featureID PATHWAY_SORTORDER                  BIOCHEMICAL SUPER_PATHWAY</span>
<span class="co">##   1:    M38002               986              1,2-propanediol         Lipid</span>
<span class="co">##   2:    M34404              1805         1,3,7-trimethylurate   Xenobiotics</span>
<span class="co">##   3:    M32391              1802            1,3-dimethylurate   Xenobiotics</span>
<span class="co">##   4:    M20675               583 1,5-anhydroglucitol (1,5-AG)  Carbohydrate</span>
<span class="co">##   5:    M21049               591           1,6-anhydroglucose  Carbohydrate</span>
<span class="co">##  ---                                                                       </span>
<span class="co">## 782:    M42314              &lt;NA&gt;                    X - 18929          &lt;NA&gt;</span>
<span class="co">## 783:    M42335              &lt;NA&gt;                    X - 18948          &lt;NA&gt;</span>
<span class="co">## 784:    M42352              &lt;NA&gt;                    X - 18965          &lt;NA&gt;</span>
<span class="co">## 785:    M42856              &lt;NA&gt;                    X - 19380          &lt;NA&gt;</span>
<span class="co">## 786:    M42913              &lt;NA&gt;                    X - 19437          &lt;NA&gt;</span>
<span class="co">##                                           SUB_PATHWAY COMP_ID  PLATFORM</span>
<span class="co">##   1:                                    Ketone bodies   38002     GC/MS</span>
<span class="co">##   2:                              Xanthine metabolism   34404 LC/MS Neg</span>
<span class="co">##   3:                              Xanthine metabolism   32391     GC/MS</span>
<span class="co">##   4: Glycolysis, gluconeogenesis, pyruvate metabolism   20675 LC/MS Neg</span>
<span class="co">##   5: Glycolysis, gluconeogenesis, pyruvate metabolism   21049     GC/MS</span>
<span class="co">##  ---                                                                   </span>
<span class="co">## 782:                                             &lt;NA&gt;   42314 LC/MS Pos</span>
<span class="co">## 783:                                             &lt;NA&gt;   42335 LC/MS Neg</span>
<span class="co">## 784:                                             &lt;NA&gt;   42352 LC/MS Neg</span>
<span class="co">## 785:                                             &lt;NA&gt;   42856 LC/MS Neg</span>
<span class="co">## 786:                                             &lt;NA&gt;   42913 LC/MS Neg</span>
<span class="co">##                      RI               MASS  PUBCHEM        CAS   KEGG   HMDb_ID</span>
<span class="co">##   1:               1041                117     &lt;NA&gt;   57-55-6; C00583 HMDB01881</span>
<span class="co">##   2:               1988              209.1    79437 5415-44-1; C16361 HMDB02123</span>
<span class="co">##   3:               1937 325.10000000000002    70346 944-73-0 ;   &lt;NA&gt; HMDB01857</span>
<span class="co">##   4:                808 163.19999999999999     &lt;NA&gt;  154-58-5; C07326 HMDB02712</span>
<span class="co">##   5:             1679.5              204.1 11412545  498-07-7;   &lt;NA&gt; HMDB00640</span>
<span class="co">##  ---                                                                           </span>
<span class="co">## 782:             3881.1              319.2     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 783:             2728.6              389.1     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 784:               4727              442.2     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 785:               2287              412.4     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 786: 1150.0999999999999              397.1     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">##      COMP_IDstr</span>
<span class="co">##   1:     M38002</span>
<span class="co">##   2:     M34404</span>
<span class="co">##   3:     M32391</span>
<span class="co">##   4:     M20675</span>
<span class="co">##   5:     M21049</span>
<span class="co">##  ---           </span>
<span class="co">## 782:     M42314</span>
<span class="co">## 783:     M42335</span>
<span class="co">## 784:     M42352</span>
<span class="co">## 785:     M42856</span>
<span class="co">## 786:     M42913</span>
<span class="co">## </span>
<span class="co">## ***  @sampleData (ID:  sampleID ) ***</span>
<span class="co">##       sampleID      AGE GENDER      BMI ETHNICITY T2D</span>
<span class="co">##   1: QMDiab254 53.10335      0 32.05128         1   0</span>
<span class="co">##   2: QMDiab290 39.79192      1 30.51426         4   0</span>
<span class="co">##   3:  QMDiab54 36.82136      0 24.16831         1   0</span>
<span class="co">##   4:  QMDiab55 34.75975      0 44.44444         1   1</span>
<span class="co">##   5: QMDiab319 50.17933      1 27.18090         1   1</span>
<span class="co">##  ---                                                 </span>
<span class="co">## 355:  QMDiab70 35.40315      1 33.83403         1   1</span>
<span class="co">## 356: QMDiab118 49.06229      1 25.64494         1   0</span>
<span class="co">## 357:  QMDiab65 47.22245      1 23.38435         1   0</span>
<span class="co">## 358: QMDiab248 56.39151      0 27.58621         1   1</span>
<span class="co">## 359:   QMDiab4 24.22450      0 41.66521         1   0</span>
<span class="co">## </span>
<span class="co">## ***  @miscData  ***</span>
<span class="co">## integer(0)</span>
<span class="co">## </span>
<span class="co">## ***  @logs  ***</span>
<span class="co">## 19/08/22 11:30:56: Import data from: /private/var/folders/mj/lsf2tqcx13d5tgl627mm9fxm0000gn/T/RtmpZ5htRD/temp_libpath862b4f79a4da/metabolomicsR/extdata/QMDiab_metabolomics_OrigScale.xlsx .</span>
<span class="co">## 19/08/22 11:30:56: Initiate data: 359 samples and 891 features.</span>
<span class="co">## 19/08/22 11:30:56: Update data, action: change_featureID, 359 samples and 891 features. </span>
<span class="co">## </span>
<span class="co">## 19/08/22 11:31:03: Run QC pipeline.</span>
<span class="co">## 19/08/22 11:31:03: Filter data with a constant column, removed 28 features. </span>
<span class="co">## 19/08/22 11:31:03: Update data, action: keep_feature, 359 samples and 863 features. </span>
<span class="co">## 19/08/22 11:31:04: Filter data with a missing rate &gt;= 0.5, removed 76 features. </span>
<span class="co">## 19/08/22 11:31:04: Update data, action: keep_feature, 359 samples and 786 features. </span>
<span class="co">## 19/08/22 11:31:04: Replace outliers using `winsorize` method 5 SDs.</span></code></pre>
</details><div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_QC.html">plot_QC</a></span><span class="op">(</span><span class="va">df_saliva</span><span class="op">)</span>
<span class="va">p</span><span class="op">$</span><span class="va">p</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-16-1.png" width="1536"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_saliva_QC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/QC_pipeline.html">QC_pipeline</a></span><span class="op">(</span><span class="va">df_saliva</span>, replace_outlier_method <span class="op">=</span> <span class="st">"winsorize"</span>, impute_method <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co"><span style="color: #00BB00;">## Constant columns n = 35</span></span>
<span class="co"><span style="color: #00BB00;">## </span></span>
<span class="co"><span style="color: #00BB00;">## Number of columns with a missing rate &gt;= 0.5 : n = 203</span></span>
<span class="co"><span style="color: #00BB00;">## </span></span></code></pre>
<details><summary><strong>click to show saliva data after QC</strong>
</summary><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_saliva_QC</span></code></pre></div>
<pre><code><span class="co">## An object of  Metabolite </span>
<span class="co">## </span>
<span class="co">## ***  @assayData (first and last 10 columns [ 321  *  365 ])  ***</span>
<span class="co">##       sampleID M43027  M38002 M35690 M20675 M35628 M37536 M37752  M35691 M38276</span>
<span class="co">##   1: QMDiab370  11974  720004  91544 211457     NA     NA 121286  352891 161984</span>
<span class="co">##   2: QMDiab245  15485  481889  80819 175312  27847  24251  78051  179709 155695</span>
<span class="co">##   3:  QMDiab34  13916  979243 104042 271930     NA  19333  54685   58106  99814</span>
<span class="co">##   4: QMDiab287  28023  825577 157057  50692     NA  22527 134397   48854 134122</span>
<span class="co">##   5: QMDiab355  22830 1150408 225965 741408     NA  67922 113970  989663 232232</span>
<span class="co">##  ---                                                                           </span>
<span class="co">## 317: QMDiab202  16493  488210 116683 158562  18241  54375 119442  302910 345072</span>
<span class="co">## 318:  QMDiab80  15254 3345272 120444 295726  14988 112052  98093 1567170 445473</span>
<span class="co">## 319: QMDiab107  31452  578446 245882 234635     NA     NA  74245  171205 132903</span>
<span class="co">## 320: QMDiab352  18975  280464  20491  77539  19239  35706  53731   95315  97904</span>
<span class="co">## 321: QMDiab127  16344  881910 206525 912153  12066  30309 102026  843075 941156</span>
<span class="co">##      M41491  M41548 M41921 M42238 M42272 M42741 M42851 M42913 M43042 M43049</span>
<span class="co">##   1: 404368 1007590  10148   6156   2352     NA   4937   5390  22149   4997</span>
<span class="co">##   2: 360478  641392  11972   5093     NA  13502   3316  10883  22797   8284</span>
<span class="co">##   3: 368498  741774   4553   4875   9858     NA   3260     NA  15291     NA</span>
<span class="co">##   4: 900064  429374   7717     NA   6371     NA   3463   6735  20655   5779</span>
<span class="co">##   5: 506638  786827   7807     NA  11181  16551   3887   3670  45619   6922</span>
<span class="co">##  ---                                                                       </span>
<span class="co">## 317: 368498  264313  12567     NA  11743  12683     NA   7243  14632     NA</span>
<span class="co">## 318: 623000  367782  29507     NA     NA  32002     NA  10592  15018   5433</span>
<span class="co">## 319: 983332  883025  13123   4657     NA  19707     NA     NA  37399   9265</span>
<span class="co">## 320:  85130  230107  15529     NA     NA   4080     NA   9140   3362     NA</span>
<span class="co">## 321: 902186      NA  17118   9253   4176  60963     NA   7590  25546   5422</span>
<span class="co">##      M43128</span>
<span class="co">##   1:  14190</span>
<span class="co">##   2:  15273</span>
<span class="co">##   3:  10602</span>
<span class="co">##   4:  13165</span>
<span class="co">##   5:  15046</span>
<span class="co">##  ---       </span>
<span class="co">## 317:  15163</span>
<span class="co">## 318:  21337</span>
<span class="co">## 319:  37183</span>
<span class="co">## 320:  21376</span>
<span class="co">## 321:  15142</span>
<span class="co">## </span>
<span class="co">## ***  @featureData (ID:  featureID ) ***</span>
<span class="co">##      featureID PATHWAY_SORTORDER                        BIOCHEMICAL</span>
<span class="co">##   1:    M43027             800.1         1,11-undecanedicarboxylate</span>
<span class="co">##   2:    M38002               986                    1,2-propanediol</span>
<span class="co">##   3:    M35690              1494                     1,4-butanediol</span>
<span class="co">##   4:    M20675               583       1,5-anhydroglucitol (1,5-AG)</span>
<span class="co">##   5:    M35628               996 1-oleoylglycerophosphoethanolamine</span>
<span class="co">##  ---                                                               </span>
<span class="co">## 360:    M42851              &lt;NA&gt;                          X - 19375</span>
<span class="co">## 361:    M42913              &lt;NA&gt;                          X - 19437</span>
<span class="co">## 362:    M43042              &lt;NA&gt;                          X - 19489</span>
<span class="co">## 363:    M43049              &lt;NA&gt;                          X - 19496</span>
<span class="co">## 364:    M43128              &lt;NA&gt;                          X - 19572</span>
<span class="co">##      SUPER_PATHWAY                                      SUB_PATHWAY COMP_ID</span>
<span class="co">##   1:         Lipid                        Fatty acid, dicarboxylate   43027</span>
<span class="co">##   2:         Lipid                                    Ketone bodies   38002</span>
<span class="co">##   3:   Xenobiotics                                         Chemical   35690</span>
<span class="co">##   4:  Carbohydrate Glycolysis, gluconeogenesis, pyruvate metabolism   20675</span>
<span class="co">##   5:         Lipid                                        Lysolipid   35628</span>
<span class="co">##  ---                                                                       </span>
<span class="co">## 360:          &lt;NA&gt;                                             &lt;NA&gt;   42851</span>
<span class="co">## 361:          &lt;NA&gt;                                             &lt;NA&gt;   42913</span>
<span class="co">## 362:          &lt;NA&gt;                                             &lt;NA&gt;   43042</span>
<span class="co">## 363:          &lt;NA&gt;                                             &lt;NA&gt;   43049</span>
<span class="co">## 364:          &lt;NA&gt;                                             &lt;NA&gt;   43128</span>
<span class="co">##       PLATFORM                 RI  MASS PUBCHEM         CAS   KEGG   HMDb_ID</span>
<span class="co">##   1: LC/MS Neg               3578 243.2   10458   505-52-2;   &lt;NA&gt; HMDB02327</span>
<span class="co">##   2:     GC/MS               1041   117    &lt;NA&gt;    57-55-6; C00583 HMDB01881</span>
<span class="co">##   3:     GC/MS               1208 115.8    &lt;NA&gt;   110-63-4;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">##   4:     GC/MS             1788.7   217    &lt;NA&gt;   154-58-5; C07326 HMDB02712</span>
<span class="co">##   5: LC/MS Neg               5928 478.3 9547071 89576-29-4;   &lt;NA&gt; HMDB11506</span>
<span class="co">##  ---                                                                        </span>
<span class="co">## 360: LC/MS Neg               1983 414.3    &lt;NA&gt;        &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 361: LC/MS Neg 1150.0999999999999 397.1    &lt;NA&gt;        &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 362: LC/MS Neg             2432.9 195.2    &lt;NA&gt;        &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 363: LC/MS Neg             3626.9 171.3    &lt;NA&gt;        &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 364: LC/MS Neg             3761.2 431.3    &lt;NA&gt;        &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">##      COMP_IDstr</span>
<span class="co">##   1:     M43027</span>
<span class="co">##   2:     M38002</span>
<span class="co">##   3:     M35690</span>
<span class="co">##   4:     M20675</span>
<span class="co">##   5:     M35628</span>
<span class="co">##  ---           </span>
<span class="co">## 360:     M42851</span>
<span class="co">## 361:     M42913</span>
<span class="co">## 362:     M43042</span>
<span class="co">## 363:     M43049</span>
<span class="co">## 364:     M43128</span>
<span class="co">## </span>
<span class="co">## ***  @sampleData (ID:  sampleID ) ***</span>
<span class="co">##       sampleID      AGE GENDER      BMI ETHNICITY T2D</span>
<span class="co">##   1: QMDiab370 56.49829      1 25.76591         1   1</span>
<span class="co">##   2: QMDiab245 51.51540      0 23.89943         1   0</span>
<span class="co">##   3:  QMDiab34 28.00548      0 23.90118         3   0</span>
<span class="co">##   4: QMDiab287 41.43463      0 31.47107         4   1</span>
<span class="co">##   5: QMDiab355 28.34771      0 25.16103         1   0</span>
<span class="co">##  ---                                                 </span>
<span class="co">## 317: QMDiab202 49.40999      1 33.72008         1   1</span>
<span class="co">## 318:  QMDiab80 25.86995      0 29.89101         1   0</span>
<span class="co">## 319: QMDiab107 38.50240      1 24.60973         2   0</span>
<span class="co">## 320: QMDiab352 41.55510      1 31.22690         3   1</span>
<span class="co">## 321: QMDiab127 34.69952      1 30.47797         1   0</span>
<span class="co">## </span>
<span class="co">## ***  @miscData  ***</span>
<span class="co">## integer(0)</span>
<span class="co">## </span>
<span class="co">## ***  @logs  ***</span>
<span class="co">## 19/08/22 11:30:56: Import data from: /private/var/folders/mj/lsf2tqcx13d5tgl627mm9fxm0000gn/T/RtmpZ5htRD/temp_libpath862b4f79a4da/metabolomicsR/extdata/QMDiab_metabolomics_OrigScale.xlsx .</span>
<span class="co">## 19/08/22 11:30:56: Initiate data: 321 samples and 602 features.</span>
<span class="co">## 19/08/22 11:30:56: Update data, action: change_featureID, 321 samples and 602 features. </span>
<span class="co">## </span>
<span class="co">## 19/08/22 11:31:06: Run QC pipeline.</span>
<span class="co">## 19/08/22 11:31:06: Filter data with a constant column, removed 35 features. </span>
<span class="co">## 19/08/22 11:31:06: Update data, action: keep_feature, 321 samples and 567 features. </span>
<span class="co">## 19/08/22 11:31:07: Filter data with a missing rate &gt;= 0.5, removed 202 features. </span>
<span class="co">## 19/08/22 11:31:07: Update data, action: keep_feature, 321 samples and 364 features. </span>
<span class="co">## 19/08/22 11:31:07: Replace outliers using `winsorize` method 5 SDs.</span></code></pre>
</details><p><br><br></p>
</div>
<div class="section level2">
<h2 id="transformation">Transformation<a class="anchor" aria-label="anchor" href="#transformation"></a>
</h2>
<p>Transformation of metabolites can alter the distribution of data and
is an essential step for the following statistical analysis. We provided
the following transformation methods: log (natural logarithm), pareto
scale, scale, and rank-based inverse normal transformation.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_plasma_QC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span><span class="va">df_plasma_QC</span>, method <span class="op">=</span> <span class="st">"half-min"</span><span class="op">)</span>
<span class="va">df_plasma_scale</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/transformation.html">transformation</a></span><span class="op">(</span><span class="va">df_plasma_QC</span>, method <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>
<span class="va">df_plasma_scale</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/transformation.html">transformation</a></span><span class="op">(</span><span class="va">df_plasma_scale</span>, method <span class="op">=</span> <span class="st">"scale"</span><span class="op">)</span></code></pre></div>
<details><summary><strong>click to show plasma data after scaling</strong>
</summary><div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_plasma_scale</span></code></pre></div>
<pre><code><span class="co">## An object of  Metabolite </span>
<span class="co">## </span>
<span class="co">## ***  @assayData (first and last 10 columns [ 356  *  546 ])  ***</span>
<span class="co">##       sampleID      M43027      M11953      M38002     M34404     M35963</span>
<span class="co">##   1: QMDiab222  0.38328962 -2.06937034 -0.25776988  0.1300954  0.1329676</span>
<span class="co">##   2: QMDiab113  1.09208975 -2.06937034 -2.09811585  0.7401431 -2.7715161</span>
<span class="co">##   3:  QMDiab29 -2.07224771  0.37986636  0.19492231 -0.6468556  0.7526296</span>
<span class="co">##   4: QMDiab243  1.41944199  0.02182271 -0.20624637  0.7059502  0.5283257</span>
<span class="co">##   5: QMDiab270 -2.07224771 -2.06937034  0.17959695 -1.5475159 -2.7715161</span>
<span class="co">##  ---                                                                    </span>
<span class="co">## 352: QMDiab352  0.07315101  0.58966058 -0.14322471  0.5981101  0.6457892</span>
<span class="co">## 353: QMDiab135  0.22511485  1.41258850  1.34579403 -1.4850024  0.7480716</span>
<span class="co">## 354: QMDiab229  1.45440521  0.18692608  0.04258334 -0.3596389 -0.1371982</span>
<span class="co">## 355: QMDiab202  0.19539060  0.50460026 -0.17539627  0.1057578  0.8349219</span>
<span class="co">## 356: QMDiab103  0.06904336 -0.17721998  0.10633646 -0.8839089 -0.1844916</span>
<span class="co">##           M35728     M20675     M34400     M33228      M42307      M42314</span>
<span class="co">##   1: -2.15022266  0.4846600  0.1504626  0.7147450 -1.66388170 -0.28947392</span>
<span class="co">##   2: -0.22011372  0.7246235 -0.1016651  0.9880064  0.23596643  1.43130720</span>
<span class="co">##   3:  0.24318100  0.4791258 -0.5220933  1.1155149  1.20217335  1.86694301</span>
<span class="co">##   4: -0.79439802 -0.2744750  0.6844679  1.0560683  0.70798740  1.24506376</span>
<span class="co">##   5: -0.81843882  1.2486906 -0.7616244  0.6788895  0.36344522 -0.39283289</span>
<span class="co">##  ---                                                                     </span>
<span class="co">## 352:  0.34505615 -0.3158120  0.4741913 -1.2884859  0.75053010  0.20341269</span>
<span class="co">## 353:  1.23459353 -0.9453014 -0.5184065  1.4284294 -0.01856785  0.08959909</span>
<span class="co">## 354: -0.02697569  0.3942445 -0.2306154 -0.2428478 -1.66388170 -1.21272633</span>
<span class="co">## 355:  0.67293679 -0.9112866  0.2460864  0.6449519  0.39090187  1.18053745</span>
<span class="co">## 356: -0.29675648  0.9495957 -0.4397136 -0.9890440  0.32962775  0.45961727</span>
<span class="co">##          M42544      M42548     M42549      M42552      M42554      M42856</span>
<span class="co">##   1: -0.7965687 -0.10047059 -0.9487939 -1.37729107  0.68352801 -0.11254665</span>
<span class="co">##   2: -0.6745840  0.07424437 -0.9487939  0.08365871  0.29566066 -0.99002949</span>
<span class="co">##   3:  0.1613181  0.41656906  0.8587908  0.18047655  0.38258560  0.68610780</span>
<span class="co">##   4:  0.5379320 -0.30181776  1.2068728  1.11631207 -0.07994001 -0.24059952</span>
<span class="co">##   5:  0.2439311 -0.20979707  0.2374080  0.04746543 -0.56284248  0.88235205</span>
<span class="co">##  ---                                                                      </span>
<span class="co">## 352:  0.8104388 -1.40388426  0.9622680  0.85693528  0.39872567  0.69786177</span>
<span class="co">## 353: -2.8888549  0.38189554 -0.9487939 -1.37729107  0.88442476 -0.68430531</span>
<span class="co">## 354: -0.1129294 -0.93235314  0.7523676 -1.37729107 -0.26061363  1.08952272</span>
<span class="co">## 355:  0.5333744 -0.32971701 -0.9487939  0.35343194  0.27619711 -0.01213065</span>
<span class="co">## 356:  0.3109356 -0.97745562 -0.9487939  0.75298733  0.47028172 -0.64000024</span>
<span class="co">##          M42887     M42913      M42914</span>
<span class="co">##   1: -1.0147901  0.0919409 -0.07636980</span>
<span class="co">##   2: -1.0843123 -0.2871253 -0.80423166</span>
<span class="co">##   3: -0.1548217 -1.1527328 -0.02857249</span>
<span class="co">##   4:  0.3980587  0.1732535 -0.87984647</span>
<span class="co">##   5:  1.4492342  1.0023618 -0.85886254</span>
<span class="co">##  ---                                  </span>
<span class="co">## 352:  0.9502102 -1.7864144 -0.17852561</span>
<span class="co">## 353: -1.7691271  0.0149663  0.86995988</span>
<span class="co">## 354:  0.7490907  0.5573375 -0.47812467</span>
<span class="co">## 355:  0.1264821 -0.6397389  2.14768955</span>
<span class="co">## 356:  0.1145265  0.6580360  0.48335069</span>
<span class="co">## </span>
<span class="co">## ***  @featureData (ID:  featureID ) ***</span>
<span class="co">##      featureID PATHWAY_SORTORDER                    BIOCHEMICAL SUPER_PATHWAY</span>
<span class="co">##   1:    M43027             800.1 1,11-Undecanedicarboxylic acid         Lipid</span>
<span class="co">##   2:    M11953              1070        1,2-dipalmitoylglycerol         Lipid</span>
<span class="co">##   3:    M38002               986                1,2-propanediol         Lipid</span>
<span class="co">##   4:    M34404              1805           1,3,7-trimethylurate   Xenobiotics</span>
<span class="co">##   5:    M35963               600           1,3-dihydroxyacetone  Carbohydrate</span>
<span class="co">##  ---                                                                         </span>
<span class="co">## 541:    M42554              &lt;NA&gt;                      X - 19147          &lt;NA&gt;</span>
<span class="co">## 542:    M42856              &lt;NA&gt;                      X - 19380          &lt;NA&gt;</span>
<span class="co">## 543:    M42887              &lt;NA&gt;                      X - 19411          &lt;NA&gt;</span>
<span class="co">## 544:    M42913              &lt;NA&gt;                      X - 19437          &lt;NA&gt;</span>
<span class="co">## 545:    M42914              &lt;NA&gt;                      X - 19438          &lt;NA&gt;</span>
<span class="co">##                                           SUB_PATHWAY COMP_ID  PLATFORM</span>
<span class="co">##   1:                        Fatty acid, dicarboxylate   43027 LC/MS Neg</span>
<span class="co">##   2:                                   Diacylglycerol   11953     GC/MS</span>
<span class="co">##   3:                                    Ketone bodies   38002     GC/MS</span>
<span class="co">##   4:                              Xanthine metabolism   34404 LC/MS Neg</span>
<span class="co">##   5: Glycolysis, gluconeogenesis, pyruvate metabolism   35963     GC/MS</span>
<span class="co">##  ---                                                                   </span>
<span class="co">## 541:                                             &lt;NA&gt;   42554 LC/MS Neg</span>
<span class="co">## 542:                                             &lt;NA&gt;   42856 LC/MS Neg</span>
<span class="co">## 543:                                             &lt;NA&gt;   42887 LC/MS Neg</span>
<span class="co">## 544:                                             &lt;NA&gt;   42913 LC/MS Neg</span>
<span class="co">## 545:                                             &lt;NA&gt;   42914 LC/MS Neg</span>
<span class="co">##                      RI  MASS PUBCHEM                 CAS   KEGG   HMDb_ID</span>
<span class="co">##   1:               3578 243.2   10458           505-52-2;   &lt;NA&gt; HMDB02327</span>
<span class="co">##   2:               2600   145   99931         40290-32-2;   &lt;NA&gt; HMDB07098</span>
<span class="co">##   3:               1041   117    &lt;NA&gt;            57-55-6; C00583 HMDB01881</span>
<span class="co">##   4:               1988 209.1   79437          5415-44-1; C16361 HMDB02123</span>
<span class="co">##   5:               1263   103     670 96-26-4;62147-49-3; C00184 HMDB01882</span>
<span class="co">##  ---                                                                      </span>
<span class="co">## 541: 4730.8999999999996 283.3    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 542:               2287 412.4    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 543:               1308 383.3    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 544: 1150.0999999999999 397.1    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 545:             1222.3 217.1    &lt;NA&gt;                &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">##      COMP_IDstr</span>
<span class="co">##   1:     M43027</span>
<span class="co">##   2:     M11953</span>
<span class="co">##   3:     M38002</span>
<span class="co">##   4:     M34404</span>
<span class="co">##   5:     M35963</span>
<span class="co">##  ---           </span>
<span class="co">## 541:     M42554</span>
<span class="co">## 542:     M42856</span>
<span class="co">## 543:     M42887</span>
<span class="co">## 544:     M42913</span>
<span class="co">## 545:     M42914</span>
<span class="co">## </span>
<span class="co">## ***  @sampleData (ID:  sampleID ) ***</span>
<span class="co">##       sampleID      AGE GENDER      BMI ETHNICITY T2D</span>
<span class="co">##   1: QMDiab222 34.50513      0 25.01021         2   0</span>
<span class="co">##   2: QMDiab113 47.06639      1 28.36776         3   0</span>
<span class="co">##   3:  QMDiab29 55.49076      1 29.70564         1   0</span>
<span class="co">##   4: QMDiab243 56.33402      1 23.14050         2   0</span>
<span class="co">##   5: QMDiab270 35.63039      1 30.06229         1   0</span>
<span class="co">##  ---                                                 </span>
<span class="co">## 352: QMDiab352 41.55510      1 31.22690         3   1</span>
<span class="co">## 353: QMDiab135 52.55305      0 29.07577         2   1</span>
<span class="co">## 354: QMDiab229 30.31348      0 22.22656         2   0</span>
<span class="co">## 355: QMDiab202 49.40999      1 33.72008         1   1</span>
<span class="co">## 356: QMDiab103 23.85489      0 35.96389         1   0</span>
<span class="co">## </span>
<span class="co">## ***  @miscData  ***</span>
<span class="co">## integer(0)</span>
<span class="co">## </span>
<span class="co">## ***  @logs  ***</span>
<span class="co">## 19/08/22 11:30:55: Import data from: /private/var/folders/mj/lsf2tqcx13d5tgl627mm9fxm0000gn/T/RtmpZ5htRD/temp_libpath862b4f79a4da/metabolomicsR/extdata/QMDiab_metabolomics_OrigScale.xlsx .</span>
<span class="co">## 19/08/22 11:30:55: Initiate data: 356 samples and 758 features.</span>
<span class="co">## 19/08/22 11:30:55: Update data, action: change_featureID, 356 samples and 758 features. </span>
<span class="co">## </span>
<span class="co">## 19/08/22 11:31:00: Run QC pipeline.</span>
<span class="co">## 19/08/22 11:31:00: Filter data with a constant column, removed 37 features. </span>
<span class="co">## 19/08/22 11:31:00: Update data, action: keep_feature, 356 samples and 721 features. </span>
<span class="co">## 19/08/22 11:31:00: Filter data with a missing rate &gt;= 0.5, removed 175 features. </span>
<span class="co">## 19/08/22 11:31:00: Update data, action: keep_feature, 356 samples and 545 features. </span>
<span class="co">## 19/08/22 11:31:01: Replace outliers using `winsorize` method 5 SDs. </span>
<span class="co">## 19/08/22 11:31:07: Impute data using `half-min` method. </span>
<span class="co">## 19/08/22 11:31:07: Transformation using `log` method. </span>
<span class="co">## 19/08/22 11:31:07: Transformation using `scale` method.</span></code></pre>
</details><p><br><br></p>
</div>
<div class="section level2">
<h2 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h2>
<div class="section level3">
<h3 id="boxplot-before-transformation">Boxplot: before transformation<a class="anchor" aria-label="anchor" href="#boxplot-before-transformation"></a>
</h3>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># if no features were selected, randomly show 16 metabolites</span>
<span class="fu"><a href="../reference/plot_Metabolite.html">plot_Metabolite</a></span><span class="op">(</span><span class="va">df_plasma_QC</span>, plot <span class="op">=</span> <span class="st">"boxplot"</span>, x <span class="op">=</span> <span class="st">"T2D"</span>, color <span class="op">=</span><span class="st">"ETHNICITY"</span>, shape <span class="op">=</span> <span class="st">"T2D"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-21-1.png" width="1152"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># select three metabolites</span>
<span class="fu"><a href="../reference/plot_Metabolite.html">plot_Metabolite</a></span><span class="op">(</span><span class="va">df_plasma_QC</span>, x <span class="op">=</span> <span class="st">"T2D"</span>, plot <span class="op">=</span> <span class="st">"boxplot"</span>, feature_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M43027"</span>,  <span class="st">"M11953"</span>, <span class="st">"M38002"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-22-1.png" width="1152"></p>
<p><br><br></p>
</div>
<div class="section level3">
<h3 id="visualization-comparisons-between-groups">Visualization: comparisons between groups<a class="anchor" aria-label="anchor" href="#visualization-comparisons-between-groups"></a>
</h3>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># comparisons between groups using `ggbetweenstats`</span>
<span class="fu"><a href="../reference/plot_Metabolite.html">plot_Metabolite</a></span><span class="op">(</span><span class="va">df_plasma_QC</span>, x <span class="op">=</span> <span class="st">"T2D"</span>, plot <span class="op">=</span> <span class="st">"betweenstats"</span>,  feature_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M43027"</span>,  <span class="st">"M11953"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-23-1.png" width="1152"></p>
<p><br><br></p>
</div>
<div class="section level3">
<h3 id="boxplot-after-transformation">Boxplot after transformation<a class="anchor" aria-label="anchor" href="#boxplot-after-transformation"></a>
</h3>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_Metabolite.html">plot_Metabolite</a></span><span class="op">(</span><span class="va">df_plasma_scale</span>, plot <span class="op">=</span> <span class="st">"boxplot"</span>, x <span class="op">=</span> <span class="st">"T2D"</span>, color <span class="op">=</span><span class="st">"ETHNICITY"</span>, shape <span class="op">=</span> <span class="st">"T2D"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-24-1.png" width="1152"></p>
<p><br><br></p>
</div>
<div class="section level3">
<h3 id="visualization-histogram">Visualization: histogram<a class="anchor" aria-label="anchor" href="#visualization-histogram"></a>
</h3>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_Metabolite.html">plot_Metabolite</a></span><span class="op">(</span><span class="va">df_plasma_scale</span>, plot <span class="op">=</span> <span class="st">"histogram"</span>, color <span class="op">=</span> <span class="st">"T2D"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-25-1.png" width="1152"></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_Metabolite.html">plot_Metabolite</a></span><span class="op">(</span><span class="va">df_plasma_scale</span>, plot <span class="op">=</span> <span class="st">"histogram"</span>, color <span class="op">=</span> <span class="st">"ETHNICITY"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-25-2.png" width="1152"></p>
<p><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="normalization">Normalization<a class="anchor" aria-label="anchor" href="#normalization"></a>
</h2>
<p>Normalization of metabolomics data is an important step to remove
systematic variation, and to facilitate the identification of real
biological metabolites. We provide popular normalization methods:
batch-based normalization, QC sample-based/nearest QC sample-based
normalization, and LOESS normalization. The latter three methods are
useful when the measurements of internal quality control samples are
provided. Briefly, in the “batch_norm” function, we implemented a
batch-based normalization method that the raw values were divided by the
median values of samples in each instrument batch to force the median
value to one in each batch. “QCmatrix_norm” function will use reference
quality control samples to normalize raw metabolite measurement
values.</p>
<details><summary><strong>click to show urine toy example for normalization </strong>
</summary><div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Take the urine data for example, the batch of the samples are missing. To illustrate the usage of the normalization method, we assume that 120 samples in each batch. </span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">$</span><span class="va">PLATFORM</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "GC/MS"     "LC/MS Neg" "LC/MS Pos"</span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># add new columns by reference (column name uppercase)</span>
<span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">[</span>, <span class="va">`GC/MS`</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">120</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">359</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">[</span>, <span class="va">`LC/MS NEG`</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">120</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">359</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">[</span>, <span class="va">`LC/MS POS`</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">120</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">359</span><span class="op">]</span><span class="op">]</span>

<span class="co"># we also added an injection order column (in the current order)</span>
<span class="va">df_urine_QC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/update_Metabolite.html">update_Metabolite</a></span><span class="op">(</span><span class="va">df_urine_QC</span>, <span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, action <span class="op">=</span> <span class="st">"injection_order"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Creat a new column `ID_injection_order`.</span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># and set one QC sample for each 10 samples. </span>

<span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">[</span>, <span class="va">QCsample</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">359</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span><span class="fl">10</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">[</span>, <span class="va">QCsample</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">QCsample</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
                       
<span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">[</span>, <span class="va">sampleID</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">359</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%%</a></span> <span class="fl">10</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"MTRX-"</span>, <span class="va">sampleID</span><span class="op">)</span>, <span class="va">sampleID</span><span class="op">)</span><span class="op">]</span>

<span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">$</span><span class="va">QCsample</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">##   1   0 </span>
<span class="co">##  35 324</span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/assayData.html">assayData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">$</span><span class="va">sampleID</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">$</span><span class="va">sampleID</span> <span class="co"># also change the ID in assayData</span>
<span class="va">df_urine_QC</span></code></pre></div>
<pre><code><span class="co">## An object of  Metabolite </span>
<span class="co">## </span>
<span class="co">## ***  @assayData (first and last 10 columns [ 359  *  787 ])  ***</span>
<span class="co">##       sampleID   M38002 M34404  M32391 M20675   M21049  M34400 M40506  M34455</span>
<span class="co">##   1: QMDiab254  1189337 146900  265120  53499 15379982  619745  53261  227263</span>
<span class="co">##   2: QMDiab290  9944836 716781 2042008  71989 26406420 1988553 123129 1221563</span>
<span class="co">##   3:  QMDiab54   926350 182438  775726  48752  7551248 1159521  72837  215868</span>
<span class="co">##   4:  QMDiab55   305459 579097  511122  21423  4655848 1102500 131674      NA</span>
<span class="co">##   5: QMDiab319   574761 295176  175826  91788  2762680  417870  21631  243512</span>
<span class="co">##  ---                                                                         </span>
<span class="co">## 355:  QMDiab70  1139559 117975  326903     NA 10051449  406266 234997  183234</span>
<span class="co">## 356: QMDiab118  1517228 234288      NA  24350  2613189  375914  51929      NA</span>
<span class="co">## 357:  QMDiab65  1028291 352068  609710 113673 29650920  621166 130037  549992</span>
<span class="co">## 358: QMDiab248  1807105 338741  148964  62614   937893  603113  48151  293379</span>
<span class="co">## 359:   QMDiab4 10103832 203176  245175  50822 28406416  243598  74996  696766</span>
<span class="co">##        M30460 M41595 M41702 M41709 M41768 M41837 M42272 M42314 M42335 M42352</span>
<span class="co">##   1:  5502123  74988  29007   4223  17008   5636  96913  31056  33430  35558</span>
<span class="co">##   2: 17475172  66278 101935  34251  14937   9552 124745  66036  39595 652059</span>
<span class="co">##   3:  6423459  74225  51295  14090  32971   9104  44266  23363  39645  62630</span>
<span class="co">##   4:  4246983  63809  31054   6151   8054  15148  77365  40193  46686  92981</span>
<span class="co">##   5:  2780633  40804   8307   3715  31370   5993  24081  16319  25583  31037</span>
<span class="co">##  ---                                                                        </span>
<span class="co">## 355:  1407294  67664  36157     NA  29194  15652  54919  52317  78413  38453</span>
<span class="co">## 356:  1856043  34332  29877  30817   5029   4603  42309  17973  25751  12967</span>
<span class="co">## 357: 10131966  57310  22374     NA  19358   9598 110335  40228  34299 108341</span>
<span class="co">## 358:       NA  26670   8525   7059  13231   9698  36055  29644  22465  19287</span>
<span class="co">## 359: 27087992  95140  66285  20229  35845  18570 185546  45205  60944 149210</span>
<span class="co">##      M42856 M42913</span>
<span class="co">##   1:  23369  21931</span>
<span class="co">##   2:  28220  27811</span>
<span class="co">##   3:  13148  25018</span>
<span class="co">##   4:  22845  23620</span>
<span class="co">##   5:  29122  41337</span>
<span class="co">##  ---              </span>
<span class="co">## 355:  33084 195136</span>
<span class="co">## 356:  15268  31577</span>
<span class="co">## 357:  52714  33244</span>
<span class="co">## 358:  27299  36462</span>
<span class="co">## 359:  35991 186372</span>
<span class="co">## </span>
<span class="co">## ***  @featureData (ID:  featureID ) ***</span>
<span class="co">##      featureID PATHWAY_SORTORDER                  BIOCHEMICAL SUPER_PATHWAY</span>
<span class="co">##   1:    M38002               986              1,2-propanediol         Lipid</span>
<span class="co">##   2:    M34404              1805         1,3,7-trimethylurate   Xenobiotics</span>
<span class="co">##   3:    M32391              1802            1,3-dimethylurate   Xenobiotics</span>
<span class="co">##   4:    M20675               583 1,5-anhydroglucitol (1,5-AG)  Carbohydrate</span>
<span class="co">##   5:    M21049               591           1,6-anhydroglucose  Carbohydrate</span>
<span class="co">##  ---                                                                       </span>
<span class="co">## 782:    M42314              &lt;NA&gt;                    X - 18929          &lt;NA&gt;</span>
<span class="co">## 783:    M42335              &lt;NA&gt;                    X - 18948          &lt;NA&gt;</span>
<span class="co">## 784:    M42352              &lt;NA&gt;                    X - 18965          &lt;NA&gt;</span>
<span class="co">## 785:    M42856              &lt;NA&gt;                    X - 19380          &lt;NA&gt;</span>
<span class="co">## 786:    M42913              &lt;NA&gt;                    X - 19437          &lt;NA&gt;</span>
<span class="co">##                                           SUB_PATHWAY COMP_ID  PLATFORM</span>
<span class="co">##   1:                                    Ketone bodies   38002     GC/MS</span>
<span class="co">##   2:                              Xanthine metabolism   34404 LC/MS Neg</span>
<span class="co">##   3:                              Xanthine metabolism   32391     GC/MS</span>
<span class="co">##   4: Glycolysis, gluconeogenesis, pyruvate metabolism   20675 LC/MS Neg</span>
<span class="co">##   5: Glycolysis, gluconeogenesis, pyruvate metabolism   21049     GC/MS</span>
<span class="co">##  ---                                                                   </span>
<span class="co">## 782:                                             &lt;NA&gt;   42314 LC/MS Pos</span>
<span class="co">## 783:                                             &lt;NA&gt;   42335 LC/MS Neg</span>
<span class="co">## 784:                                             &lt;NA&gt;   42352 LC/MS Neg</span>
<span class="co">## 785:                                             &lt;NA&gt;   42856 LC/MS Neg</span>
<span class="co">## 786:                                             &lt;NA&gt;   42913 LC/MS Neg</span>
<span class="co">##                      RI               MASS  PUBCHEM        CAS   KEGG   HMDb_ID</span>
<span class="co">##   1:               1041                117     &lt;NA&gt;   57-55-6; C00583 HMDB01881</span>
<span class="co">##   2:               1988              209.1    79437 5415-44-1; C16361 HMDB02123</span>
<span class="co">##   3:               1937 325.10000000000002    70346 944-73-0 ;   &lt;NA&gt; HMDB01857</span>
<span class="co">##   4:                808 163.19999999999999     &lt;NA&gt;  154-58-5; C07326 HMDB02712</span>
<span class="co">##   5:             1679.5              204.1 11412545  498-07-7;   &lt;NA&gt; HMDB00640</span>
<span class="co">##  ---                                                                           </span>
<span class="co">## 782:             3881.1              319.2     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 783:             2728.6              389.1     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 784:               4727              442.2     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 785:               2287              412.4     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">## 786: 1150.0999999999999              397.1     &lt;NA&gt;       &lt;NA&gt;   &lt;NA&gt;      &lt;NA&gt;</span>
<span class="co">##      COMP_IDstr</span>
<span class="co">##   1:     M38002</span>
<span class="co">##   2:     M34404</span>
<span class="co">##   3:     M32391</span>
<span class="co">##   4:     M20675</span>
<span class="co">##   5:     M21049</span>
<span class="co">##  ---           </span>
<span class="co">## 782:     M42314</span>
<span class="co">## 783:     M42335</span>
<span class="co">## 784:     M42352</span>
<span class="co">## 785:     M42856</span>
<span class="co">## 786:     M42913</span>
<span class="co">## </span>
<span class="co">## ***  @sampleData (ID:  sampleID ) ***</span>
<span class="co">##       sampleID      AGE GENDER      BMI ETHNICITY T2D GC/MS LC/MS NEG LC/MS POS</span>
<span class="co">##   1: QMDiab254 53.10335      0 32.05128         1   0     1         1         1</span>
<span class="co">##   2: QMDiab290 39.79192      1 30.51426         4   0     1         1         1</span>
<span class="co">##   3:  QMDiab54 36.82136      0 24.16831         1   0     1         1         1</span>
<span class="co">##   4:  QMDiab55 34.75975      0 44.44444         1   1     1         1         1</span>
<span class="co">##   5: QMDiab319 50.17933      1 27.18090         1   1     1         1         1</span>
<span class="co">##  ---                                                                           </span>
<span class="co">## 355:  QMDiab70 35.40315      1 33.83403         1   1     3         3         3</span>
<span class="co">## 356: QMDiab118 49.06229      1 25.64494         1   0     3         3         3</span>
<span class="co">## 357:  QMDiab65 47.22245      1 23.38435         1   0     3         3         3</span>
<span class="co">## 358: QMDiab248 56.39151      0 27.58621         1   1     3         3         3</span>
<span class="co">## 359:   QMDiab4 24.22450      0 41.66521         1   0     3         3         3</span>
<span class="co">##      ID_injection_order QCsample</span>
<span class="co">##   1:                  1        0</span>
<span class="co">##   2:                  2        0</span>
<span class="co">##   3:                  3        0</span>
<span class="co">##   4:                  4        0</span>
<span class="co">##   5:                  5        0</span>
<span class="co">##  ---                            </span>
<span class="co">## 355:                355        0</span>
<span class="co">## 356:                356        0</span>
<span class="co">## 357:                357        0</span>
<span class="co">## 358:                358        0</span>
<span class="co">## 359:                359        0</span>
<span class="co">## </span>
<span class="co">## ***  @miscData  ***</span>
<span class="co">## integer(0)</span>
<span class="co">## </span>
<span class="co">## ***  @logs  ***</span>
<span class="co">## 19/08/22 11:30:56: Import data from: /private/var/folders/mj/lsf2tqcx13d5tgl627mm9fxm0000gn/T/RtmpZ5htRD/temp_libpath862b4f79a4da/metabolomicsR/extdata/QMDiab_metabolomics_OrigScale.xlsx .</span>
<span class="co">## 19/08/22 11:30:56: Initiate data: 359 samples and 891 features.</span>
<span class="co">## 19/08/22 11:30:56: Update data, action: change_featureID, 359 samples and 891 features. </span>
<span class="co">## </span>
<span class="co">## 19/08/22 11:31:03: Run QC pipeline.</span>
<span class="co">## 19/08/22 11:31:03: Filter data with a constant column, removed 28 features. </span>
<span class="co">## 19/08/22 11:31:03: Update data, action: keep_feature, 359 samples and 863 features. </span>
<span class="co">## 19/08/22 11:31:04: Filter data with a missing rate &gt;= 0.5, removed 76 features. </span>
<span class="co">## 19/08/22 11:31:04: Update data, action: keep_feature, 359 samples and 786 features. </span>
<span class="co">## 19/08/22 11:31:04: Replace outliers using `winsorize` method 5 SDs. </span>
<span class="co">## 19/08/22 11:31:22: Update data, action: injection_order, 359 samples and 786 features. </span>
<span class="co">## 19/08/22 11:31:23: Current data, 359 samples and 786 features.</span></code></pre>
</details><p>We then selected the first 16 metabolites to show boxplot</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">v_features</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span><span class="op">$</span><span class="va">featureID</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span>

<span class="fu"><a href="../reference/plot_injection_order.html">plot_injection_order</a></span><span class="op">(</span><span class="va">df_urine_QC</span>, color <span class="op">=</span> <span class="st">"QCsample"</span>, shape <span class="op">=</span> <span class="st">"GC/MS"</span>, feature_name <span class="op">=</span> <span class="va">v_features</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-27-1.png" width="1152"></p>
<p><br><br></p>
<div class="section level3">
<h3 id="normalization-1-batch-norm">Normalization 1: batch-norm<a class="anchor" aria-label="anchor" href="#normalization-1-batch-norm"></a>
</h3>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_urine_QC_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/batch_norm.html">batch_norm</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Platform information in @featureData:</span>
<span class="co">## platforms</span>
<span class="co">##     GC/MS LC/MS Neg LC/MS Pos </span>
<span class="co">##       153       355       278 </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Sample size in platform GC/MS</span>
<span class="co">##   1   2   3 </span>
<span class="co">## 120 120 119</span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_injection_order.html">plot_injection_order</a></span><span class="op">(</span><span class="va">df_urine_QC_norm</span>, color <span class="op">=</span> <span class="st">"QCsample"</span>, shape <span class="op">=</span> <span class="st">"GC/MS"</span>, feature_name <span class="op">=</span> <span class="va">v_features</span><span class="op">)</span>
<span class="va">p1</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-28-1.png" width="1152"></p>
<br><details><summary><strong>click to show other normalization methods </strong>
</summary><p>Normalization 2: QCmatrix_norm</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_urine_QC_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/QCmatrix_norm.html">QCmatrix_norm</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Platform information in @featureData:</span>
<span class="co">## platforms</span>
<span class="co">##     GC/MS LC/MS Neg LC/MS Pos </span>
<span class="co">##       153       355       278 </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Sample size in platform GC/MS</span>
<span class="co">##   1   2   3 </span>
<span class="co">## 120 120 119 </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">##  Number of QC samples n = 35</span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_injection_order.html">plot_injection_order</a></span><span class="op">(</span><span class="va">df_urine_QC_norm</span>, color <span class="op">=</span> <span class="st">"QCsample"</span>, shape <span class="op">=</span> <span class="st">"GC/MS"</span>, feature_name <span class="op">=</span> <span class="va">v_features</span><span class="op">)</span>
<span class="va">p2</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-29-1.png" width="1152"></p>
<p>Normalization 3: nearestQC_norm</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_urine_QC_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nearestQC_norm.html">nearestQC_norm</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## The top ten sample ID (in injection order):</span>
<span class="co">## QMDiab254, QMDiab290, QMDiab54, QMDiab55, QMDiab319, QMDiab255, QMDiab190, QMDiab247, QMDiab209, MTRX-QMDiab94 </span>
<span class="co">## </span>
<span class="co">## Platform information in @featureData:</span>
<span class="co">## platforms</span>
<span class="co">##     GC/MS LC/MS Neg LC/MS Pos </span>
<span class="co">##       153       355       278 </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Sample size in platform GC/MS</span>
<span class="co">##   1   2   3 </span>
<span class="co">## 120 120 119 </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">##  Number of QC samples n = 35</span></code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_injection_order.html">plot_injection_order</a></span><span class="op">(</span><span class="va">df_urine_QC_norm</span>, color <span class="op">=</span> <span class="st">"QCsample"</span>, shape <span class="op">=</span> <span class="st">"GC/MS"</span>, feature_name <span class="op">=</span> <span class="va">v_features</span><span class="op">)</span>
<span class="va">p3</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-30-1.png" width="1152"></p>
<p>Normalization 4: modelling_norm</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_urine_QC_norm_LOESS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelling_norm.html">modelling_norm</a></span><span class="op">(</span><span class="va">df_urine_QC</span>, method <span class="op">=</span> <span class="st">"LOESS"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  ******** modelling methods are in testing! ********</span>
<span class="co">## </span>
<span class="co">## Platform information in @featureData:</span>
<span class="co">## platforms</span>
<span class="co">##     GC/MS LC/MS Neg LC/MS Pos </span>
<span class="co">##       153       355       278 </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Sample size in platform GC/MS</span>
<span class="co">##   1   2   3 </span>
<span class="co">## 120 120 119 </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">##  Number of QC samples n = 35</span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_injection_order.html">plot_injection_order</a></span><span class="op">(</span><span class="va">df_urine_QC_norm</span>, color <span class="op">=</span> <span class="st">"QCsample"</span>, shape <span class="op">=</span> <span class="st">"GC/MS"</span>, feature_name <span class="op">=</span> <span class="va">v_features</span><span class="op">)</span>
<span class="va">p4</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-31-1.png" width="1152"></p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># to benchmark the performance</span>
<span class="va">df_urine_QC_norm_KNN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modelling_norm.html">modelling_norm</a></span><span class="op">(</span><span class="va">df_urine_QC</span>, method <span class="op">=</span> <span class="st">"KNN"</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> </code></pre></div>
<pre><code><span class="co">##  ******** modelling methods are in testing! ********</span>
<span class="co">## </span>
<span class="co">## Platform information in @featureData:</span>
<span class="co">## platforms</span>
<span class="co">##     GC/MS LC/MS Neg LC/MS Pos </span>
<span class="co">##       153       355       278 </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">## Sample size in platform GC/MS</span>
<span class="co">##   1   2   3 </span>
<span class="co">## 120 120 119 </span>
<span class="co">## </span>
<span class="co">## </span>
<span class="co">##  Number of QC samples n = 35</span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_injection_order.html">plot_injection_order</a></span><span class="op">(</span><span class="va">df_urine_QC_norm_KNN</span>, color <span class="op">=</span> <span class="st">"QCsample"</span>, shape <span class="op">=</span> <span class="st">"GC/MS"</span>, feature_name <span class="op">=</span> <span class="va">v_features</span><span class="op">)</span>
<span class="va">p5</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-31-2.png" width="1152"></p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># test XGBoost</span>
<span class="co"># df_urine_QC_norm_xgboost &lt;- modelling_norm(df_urine_QC, method = "XGBoost") </span>
<span class="co"># p6 &lt;- plot_injection_order(df_urine_QC_norm_xgboost, color = "QCsample", shape = "GC/MS", feature_name = v_features)</span>
<span class="co"># p6</span></code></pre></div>
</details><p><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="dimensional-reduction">Dimensional reduction<a class="anchor" aria-label="anchor" href="#dimensional-reduction"></a>
</h2>
<p>Dimensional reduction strategies on metabolites data can be used to
detect batch effects, sample outliers, and real biological subgroups. We
included principal components analysis (PCA), manifold approximation and
projection (UMAP), and t-distributed stochastic neighbor embedding
(tSNE) methods.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_plasma_PCA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_PCA.html">run_PCA</a></span><span class="op">(</span><span class="va">df_plasma_QC</span><span class="op">)</span>

<span class="fu"><a href="../reference/plot_PCA.html">plot_PCA</a></span><span class="op">(</span><span class="va">df_plasma_PCA</span>, color <span class="op">=</span><span class="st">"ETHNICITY"</span>, shape <span class="op">=</span> <span class="st">"T2D"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_UMAP.html">plot_UMAP</a></span><span class="op">(</span><span class="va">df_plasma_QC</span>, color <span class="op">=</span><span class="st">"ETHNICITY"</span>, shape <span class="op">=</span> <span class="st">"T2D"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-32-2.png" width="700"></p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_tsne.html">plot_tsne</a></span><span class="op">(</span><span class="va">df_plasma_QC</span>, color <span class="op">=</span><span class="st">"ETHNICITY"</span>, shape <span class="op">=</span> <span class="st">"T2D"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-32-3.png" width="700"></p>
<p><br><br></p>
</div>
<div class="section level2">
<h2 id="correlation">Correlation<a class="anchor" aria-label="anchor" href="#correlation"></a>
</h2>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># pairwise correlation of metabolites between two different fluids</span>

<span class="co"># plasma vs urine</span>
<span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correlation.html">correlation</a></span><span class="op">(</span><span class="va">df_plasma_QC</span>, <span class="va">df_urine_QC</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Identify  356  samples in data A, and  359  samples in data B, with  312  overlap samples.</span>
<span class="co">## Identify  545  features in data A, and  786  features in data B, with  248  overlap features.</span></code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dd</span>, <span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">df_plasma_QC</span><span class="op">)</span>, by.x <span class="op">=</span> <span class="st">"term"</span>, by.y <span class="op">=</span> <span class="st">"featureID"</span><span class="op">)</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">SUPER_PATHWAY</span>, y <span class="op">=</span> <span class="va">r</span>, fill <span class="op">=</span> <span class="va">SUPER_PATHWAY</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span> size<span class="op">=</span><span class="fl">0.4</span>, alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"Set1"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">60</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"plasma vs urine"</span><span class="op">)</span>

<span class="va">p</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-33-1.png" width="960"></p>
<details><summary><strong>click to show plasma vs saliva &amp; urine vs saliva</strong>
</summary><div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plasma vs saliva</span>
<span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correlation.html">correlation</a></span><span class="op">(</span><span class="va">df_plasma_QC</span>, <span class="va">df_saliva_QC</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Identify  356  samples in data A, and  321  samples in data B, with  319  overlap samples.</span>
<span class="co">## Identify  545  features in data A, and  364  features in data B, with  137  overlap features.</span></code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dd</span>, <span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">df_plasma_QC</span><span class="op">)</span>, by.x <span class="op">=</span> <span class="st">"term"</span>, by.y <span class="op">=</span> <span class="st">"featureID"</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">SUPER_PATHWAY</span>, y <span class="op">=</span> <span class="va">r</span>, fill <span class="op">=</span> <span class="va">SUPER_PATHWAY</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.4</span>, alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"Set1"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">60</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"plasma vs saliva"</span><span class="op">)</span>


<span class="co"># urine vs saliva</span>
<span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/correlation.html">correlation</a></span><span class="op">(</span><span class="va">df_urine_QC</span>, <span class="va">df_saliva_QC</span>, method <span class="op">=</span> <span class="st">"spearman"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Identify  359  samples in data A, and  321  samples in data B, with  282  overlap samples.</span>
<span class="co">## Identify  786  features in data A, and  364  features in data B, with  155  overlap features.</span></code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dd</span>, <span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">df_urine_QC</span><span class="op">)</span>, by.x <span class="op">=</span> <span class="st">"term"</span>, by.y <span class="op">=</span> <span class="st">"featureID"</span><span class="op">)</span>

<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dd</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">SUPER_PATHWAY</span>, y <span class="op">=</span> <span class="va">r</span>, fill <span class="op">=</span> <span class="va">SUPER_PATHWAY</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">0.4</span>, alpha<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span> <span class="op">+</span>
   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">9</span>, <span class="st">"Set1"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">60</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"urine vs saliva"</span><span class="op">)</span>


<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p2</span>, <span class="va">p3</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">p</span></code></pre></div>
<img src="Introduction_files/figure-html/unnamed-chunk-34-1.png" width="1344"></details><p><br><br></p>
</div>
<div class="section level2">
<h2 id="association-analysis">Association analysis<a class="anchor" aria-label="anchor" href="#association-analysis"></a>
</h2>
<div class="section level3">
<h3 id="association-analysis-1-linear-regression">Association analysis 1: linear regression<a class="anchor" aria-label="anchor" href="#association-analysis-1-linear-regression"></a>
</h3>
<p>Association analysis between metabolites and interested outcomes was
implemented in the <code>{regression}</code> function, supporting
general linear regression, logistic regression, poisson regression,
proportional hazards regression model, linear mixed-effects model, and
logistic linear mixed-effects model, with or without covariates. All the
regression models can be run for selected metabolites or all metabolites
in a single job with the support of parallel computing. We also provided
the option to run linear regression models where a metabolite is the
outcome (an example is shown in the Section “## Extension 4:
Nightingale’s NMR platform” below).</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regression.html">regression</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">df_plasma_scale</span>, phenoData <span class="op">=</span> <span class="cn">NULL</span>, 
                     model <span class="op">=</span> <span class="st">"lm"</span>, outcome <span class="op">=</span> <span class="st">"BMI"</span>,
                     covars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"GENDER"</span>, <span class="st">"ETHNICITY"</span><span class="op">)</span>, 
                     factors <span class="op">=</span> <span class="st">"ETHNICITY"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Regression for 1 outcome(s). </span>
<span class="co">## </span>
<span class="co">## Build formula using covars and outcomes. </span>
<span class="co">## </span>
<span class="co">## Run `lm` model for 545 features: </span>
<span class="co">## BMI ~ AGE + GENDER + ETHNICITY + `feature`</span></code></pre>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fit_lm</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      term     estimate std.error   statistic   p.value   n outcome model</span>
<span class="co">## 1: M43027 -0.287065678 0.2909369 -0.98669400 0.3244762 356     BMI    lm</span>
<span class="co">## 2: M11953  0.285148910 0.2945365  0.96812761 0.3336511 356     BMI    lm</span>
<span class="co">## 3: M38002  0.063510129 0.2960686  0.21451153 0.8302735 356     BMI    lm</span>
<span class="co">## 4: M34404  0.459471416 0.3109698  1.47754337 0.1404319 356     BMI    lm</span>
<span class="co">## 5: M35963 -0.008355339 0.2942752 -0.02839294 0.9773650 356     BMI    lm</span>
<span class="co">## 6: M35728  0.280617622 0.2929012  0.95806251 0.3386944 356     BMI    lm</span>
<span class="co">##    p.value.adj</span>
<span class="co">## 1:           1</span>
<span class="co">## 2:           1</span>
<span class="co">## 3:           1</span>
<span class="co">## 4:           1</span>
<span class="co">## 5:           1</span>
<span class="co">## 6:           1</span></code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">fit_lm</span>, <span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">df_plasma_scale</span><span class="op">)</span>, by.x <span class="op">=</span> <span class="st">"term"</span>, by.y <span class="op">=</span> <span class="st">"featureID"</span><span class="op">)</span>

<span class="va">dd</span><span class="op">[</span>, <span class="va">sig</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">p.value.adj</span> <span class="op">&lt;</span> <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="../reference/plot_volcano.html">plot_volcano</a></span><span class="op">(</span><span class="va">dd</span>, color <span class="op">=</span> <span class="cn">NULL</span>, label <span class="op">=</span> <span class="st">"BIOCHEMICAL"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-35-1.png" width="700"></p>
<div class="section level4">
<h4 id="association-analysis-1-linear-regression-annotation-in-hmdb">Association analysis 1: linear regression – annotation in HMDB<a class="anchor" aria-label="anchor" href="#association-analysis-1-linear-regression-annotation-in-hmdb"></a>
</h4>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sig</span> <span class="op">&lt;-</span> <span class="va">dd</span><span class="op">[</span><span class="va">sig</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">HMDb_ID</span><span class="op">)</span>, <span class="op">]</span>


<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span>

<span class="co"># this function is used to change HMDB ID.</span>
<span class="va">add_two_zeros</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_count.html" class="external-link">str_count</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">9</span><span class="op">)</span> <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"HMDB"</span>, <span class="st">"HMDB00"</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">v_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">df_sig</span><span class="op">$</span><span class="va">HMDb_ID</span>, <span class="va">add_two_zeros</span><span class="op">)</span>
<span class="va">v_list</span></code></pre></div>
<pre><code><span class="co">##     HMDB00289     HMDB00904     HMDB00131     HMDB00019     HMDB00746 </span>
<span class="co">## "HMDB0000289" "HMDB0000904" "HMDB0000131" "HMDB0000019" "HMDB0000746" </span>
<span class="co">##     HMDB03339     HMDB00123     HMDB11172     HMDB03229     HMDB12458 </span>
<span class="co">## "HMDB0003339" "HMDB0000123" "HMDB0011172" "HMDB0003229" "HMDB0012458"</span></code></pre>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sig</span><span class="op">$</span><span class="va">HMDB_anno</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/anno_hmdb.html">anno_hmdb</a></span><span class="op">(</span><span class="va">v_list</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Error in validObject(.Object) : </span>
<span class="co">##   invalid class "HmdbEntry" object: invalid object for slot "diseases" in class "HmdbEntry": got class "NULL", should be or extend class "matrix"</span>
<span class="co">## Error in validObject(.Object) : </span>
<span class="co">##   invalid class "HmdbEntry" object: 1: invalid object for slot "diseases" in class "HmdbEntry": got class "NULL", should be or extend class "matrix"</span>
<span class="co">## invalid class "HmdbEntry" object: 2: invalid object for slot "biospecimens" in class "HmdbEntry": got class "NULL", should be or extend class "character"</span></code></pre>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sig</span></code></pre></div>
<pre><code><span class="co">##       term  estimate std.error statistic      p.value   n outcome model</span>
<span class="co">##  1: M01604  1.233122 0.2974927  4.145050 4.268753e-05 356     BMI    lm</span>
<span class="co">##  2: M02132 -1.128078 0.2896670 -3.894397 1.179704e-04 356     BMI    lm</span>
<span class="co">##  3: M15122  1.878923 0.3274293  5.738408 2.075711e-08 356     BMI    lm</span>
<span class="co">##  4: M21047  1.254033 0.2858542  4.386968 1.524314e-05 356     BMI    lm</span>
<span class="co">##  5: M22132  1.166521 0.2963684  3.936049 9.999276e-05 356     BMI    lm</span>
<span class="co">##  6: M32322  1.577327 0.2986756  5.281072 2.264323e-07 356     BMI    lm</span>
<span class="co">##  7: M32338 -1.263167 0.2903777 -4.350081 1.788941e-05 356     BMI    lm</span>
<span class="co">##  8: M32393  1.398461 0.3180297  4.397267 1.457399e-05 356     BMI    lm</span>
<span class="co">##  9: M33447  1.274460 0.3003524  4.243215 2.826921e-05 356     BMI    lm</span>
<span class="co">## 10: M36776  1.390018 0.2915057  4.768408 2.731729e-06 356     BMI    lm</span>
<span class="co">##      p.value.adj PATHWAY_SORTORDER</span>
<span class="co">##  1: 2.326470e-02              1247</span>
<span class="co">##  2: 6.429386e-02               263</span>
<span class="co">##  3: 1.131263e-05               959</span>
<span class="co">##  4: 8.307512e-03               182</span>
<span class="co">##  5: 5.449606e-02               189</span>
<span class="co">##  6: 1.234056e-04                39</span>
<span class="co">##  7: 9.749729e-03                 1</span>
<span class="co">##  8: 7.942822e-03               460</span>
<span class="co">##  9: 1.540672e-02               702</span>
<span class="co">## 10: 1.488793e-03              1157</span>
<span class="co">##                                        BIOCHEMICAL SUPER_PATHWAY</span>
<span class="co">##  1:                                          urate    Nucleotide</span>
<span class="co">##  2:                                     citrulline    Amino acid</span>
<span class="co">##  3:                                       glycerol         Lipid</span>
<span class="co">##  4:                         3-methyl-2-oxobutyrate    Amino acid</span>
<span class="co">##  5:                       alpha-hydroxyisocaproate    Amino acid</span>
<span class="co">##  6:                                      glutamate    Amino acid</span>
<span class="co">##  7:                                        glycine    Amino acid</span>
<span class="co">##  8:                           gamma-glutamylvaline       Peptide</span>
<span class="co">##  9:                          palmitoleate (16:1n7)         Lipid</span>
<span class="co">## 10: 7-alpha-hydroxy-3-oxo-4-cholestenoate (7-Hoca)         Lipid</span>
<span class="co">##                                     SUB_PATHWAY COMP_ID  PLATFORM     RI</span>
<span class="co">##  1:         Purine metabolism, urate metabolism    1604 LC/MS Neg    769</span>
<span class="co">##  2: Urea cycle; arginine-, proline-, metabolism    2132 LC/MS Pos    715</span>
<span class="co">##  3:                     Glycerolipid metabolism   15122     GC/MS   1311</span>
<span class="co">##  4:   Valine, leucine and isoleucine metabolism   21047 LC/MS Neg   1489</span>
<span class="co">##  5:   Valine, leucine and isoleucine metabolism   22132 LC/MS Neg   1854</span>
<span class="co">##  6:                        Glutamate metabolism   32322     GC/MS 1836.8</span>
<span class="co">##  7:    Glycine, serine and threonine metabolism   32338     GC/MS 1486.9</span>
<span class="co">##  8:                              gamma-glutamyl   32393 LC/MS Pos   2040</span>
<span class="co">##  9:                       Long chain fatty acid   33447 LC/MS Neg   5477</span>
<span class="co">## 10:                              Sterol/Steroid   36776 LC/MS Neg   5268</span>
<span class="co">##                   MASS    PUBCHEM               CAS   KEGG   HMDb_ID COMP_IDstr</span>
<span class="co">##  1:              167.1       &lt;NA&gt; 69-93-2;120K5305; C00366 HMDB00289     M01604</span>
<span class="co">##  2:              176.1        833         372-75-8; C00327 HMDB00904     M02132</span>
<span class="co">##  3:                205        753          56-81-5; C00116 HMDB00131     M15122</span>
<span class="co">##  4:              115.1         49        3715-29-5; C00141 HMDB00019     M21047</span>
<span class="co">##  5: 131.19999999999999      83697       10303-64-7; C03264 HMDB00746     M22132</span>
<span class="co">##  6:              362.2        611          56-86-0; C00025 HMDB03339     M32322</span>
<span class="co">##  7:              218.1 5257127750          56-40-6; C00037 HMDB00123     M32338</span>
<span class="co">##  8:              247.2       &lt;NA&gt;        2746-34-1;   &lt;NA&gt; HMDB11172     M32393</span>
<span class="co">##  9:              253.3     445638         373-49-9; C08362 HMDB03229     M33447</span>
<span class="co">## 10:              429.4    3081085      115538-85-7; C17337 HMDB12458     M36776</span>
<span class="co">##     sig      HMDB_anno</span>
<span class="co">##  1:   1 &lt;HmdbEntry[6]&gt;</span>
<span class="co">##  2:   1 &lt;HmdbEntry[6]&gt;</span>
<span class="co">##  3:   1 &lt;HmdbEntry[6]&gt;</span>
<span class="co">##  4:   1 &lt;HmdbEntry[6]&gt;</span>
<span class="co">##  5:   1 &lt;HmdbEntry[6]&gt;</span>
<span class="co">##  6:   1 &lt;HmdbEntry[6]&gt;</span>
<span class="co">##  7:   1 &lt;HmdbEntry[6]&gt;</span>
<span class="co">##  8:   1     &lt;list[46]&gt;</span>
<span class="co">##  9:   1 &lt;HmdbEntry[6]&gt;</span>
<span class="co">## 10:   1     &lt;list[46]&gt;</span></code></pre>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># explore the first entry</span>
<span class="va">df_sig</span><span class="op">$</span><span class="va">HMDB_anno</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">metabolite</span></code></pre></div>
<pre><code><span class="co">## [1] "Uric acid"</span></code></pre>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_sig</span><span class="op">$</span><span class="va">HMDB_anno</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">diseases</span></code></pre></div>
<pre><code><span class="co">##            disease                    disease                      disease </span>
<span class="co">## name       "Diabetes mellitus type 2" "Impaired glucose tolerance" "Gout"  </span>
<span class="co">## omim_id    "125853"                   NULL                         "138900"</span>
<span class="co">## references list,33                    list,2                       list,4  </span>
<span class="co">##            disease                disease              disease               </span>
<span class="co">## name       "Lesch-Nyhan syndrome" "Multiple sclerosis" "Bacterial meningitis"</span>
<span class="co">## omim_id    "300322"               "126200"             NULL                  </span>
<span class="co">## references list,10                list,30              list,4                </span>
<span class="co">##            disease    disease  disease          disease        </span>
<span class="co">## name       "Cachexia" "Uremia" "Stomach cancer" "Schizophrenia"</span>
<span class="co">## omim_id    NULL       NULL     "137215"         "181500"       </span>
<span class="co">## references list,4     list,42  list,10          list,64        </span>
<span class="co">##            disease                                disease             </span>
<span class="co">## name       "Sulfite oxidase deficiency, ISOLATED" "Xanthinuria type 1"</span>
<span class="co">## omim_id    "272300"                               "278300"            </span>
<span class="co">## references list,10                                list,6              </span>
<span class="co">##            disease                          disease                 </span>
<span class="co">## name       "Molybdenum cofactor deficiency" "Primary hypomagnesemia"</span>
<span class="co">## omim_id    NULL                             "248250"                </span>
<span class="co">## references list,10                          list,8                  </span>
<span class="co">##            disease                                </span>
<span class="co">## name       "Fructose-1,6-diphosphatase deficiency"</span>
<span class="co">## omim_id    "229700"                               </span>
<span class="co">## references list,4                                 </span>
<span class="co">##            disease                                               </span>
<span class="co">## name       "Phosphoribosylpyrophosphate Synthetase Superactivity"</span>
<span class="co">## omim_id    "300661"                                              </span>
<span class="co">## references list,4                                                </span>
<span class="co">##            disease            disease                                  </span>
<span class="co">## name       "Fanconi syndrome" "Cerebral creatine deficiency syndrome 2"</span>
<span class="co">## omim_id    NULL               "612736"                                 </span>
<span class="co">## references list,6             list,4                                   </span>
<span class="co">##            disease             disease                                         </span>
<span class="co">## name       "D-Lactic Acidosis" "Long-chain Fatty Acids, Defect in Transport of"</span>
<span class="co">## omim_id    "245450"            "603376"                                        </span>
<span class="co">## references list,2              list,2                                          </span>
<span class="co">##            disease                                      </span>
<span class="co">## name       "congenital disorder of glycosylation CDG-Ia"</span>
<span class="co">## omim_id    "212065"                                     </span>
<span class="co">## references list,2                                       </span>
<span class="co">##            disease                            disease                  </span>
<span class="co">## name       "Molybdenium co-factor deficiency" "Fanconi Bickel syndrome"</span>
<span class="co">## omim_id    "252150"                           "227810"                 </span>
<span class="co">## references list,4                             list,2                   </span>
<span class="co">##            disease                     disease     </span>
<span class="co">## name       "Degenerative disc disease" "Meningitis"</span>
<span class="co">## omim_id    NULL                        NULL        </span>
<span class="co">## references list,2                      list,22     </span>
<span class="co">##            disease                             disease                       </span>
<span class="co">## name       "Adenylosuccinate lyase deficiency" "3-Methyl-crotonyl-glycinuria"</span>
<span class="co">## omim_id    "103050"                            "210200"                      </span>
<span class="co">## references list,6                              list,10                       </span>
<span class="co">##            disease             disease          </span>
<span class="co">## name       "Colorectal cancer" "Canavan disease"</span>
<span class="co">## omim_id    "114500"            "271900"         </span>
<span class="co">## references list,15             list,14          </span>
<span class="co">##            disease                            disease                        </span>
<span class="co">## name       "Fructose intolerance, hereditary" "Nucleotide Depletion Syndrome"</span>
<span class="co">## omim_id    "229600"                           NULL                           </span>
<span class="co">## references list,4                             list,2</span></code></pre>
<p><br><br></p>
</div>
</div>
<div class="section level3">
<h3 id="association-analysis-2-logistic-regression">Association analysis 2: logistic regression<a class="anchor" aria-label="anchor" href="#association-analysis-2-logistic-regression"></a>
</h3>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regression.html">regression</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">df_plasma_scale</span>, phenoData <span class="op">=</span> <span class="cn">NULL</span>, 
                      model <span class="op">=</span> <span class="st">"logistic"</span>, outcome <span class="op">=</span> <span class="st">"T2D"</span>,
                      covars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>,<span class="st">"GENDER"</span>, <span class="st">"ETHNICITY"</span><span class="op">)</span>, 
                      factors <span class="op">=</span> <span class="st">"ETHNICITY"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Regression for 1 outcome(s). </span>
<span class="co">## </span>
<span class="co">## Build formula using covars and outcomes. </span>
<span class="co">## </span>
<span class="co">## Run `logistic` model for 545 features: </span>
<span class="co">## T2D ~ AGE + GENDER + ETHNICITY + `feature`</span></code></pre>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fit_glm</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      term    estimate std.error   statistic    p.value   n outcome    model</span>
<span class="co">## 1: M43027 -0.01513772 0.1249949 -0.12110676 0.90360647 356     T2D logistic</span>
<span class="co">## 2: M11953  0.07313020 0.1258779  0.58096115 0.56126664 356     T2D logistic</span>
<span class="co">## 3: M38002  0.01273692 0.1286644  0.09899333 0.92114357 356     T2D logistic</span>
<span class="co">## 4: M34404  0.02452545 0.1413296  0.17353372 0.86223193 356     T2D logistic</span>
<span class="co">## 5: M35963  0.35664968 0.1338055  2.66543322 0.00768892 356     T2D logistic</span>
<span class="co">## 6: M35728  0.01557804 0.1306566  0.11922888 0.90509402 356     T2D logistic</span>
<span class="co">##    p.value.adj</span>
<span class="co">## 1:           1</span>
<span class="co">## 2:           1</span>
<span class="co">## 3:           1</span>
<span class="co">## 4:           1</span>
<span class="co">## 5:           1</span>
<span class="co">## 6:           1</span></code></pre>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">fit_glm</span>, <span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">df_plasma_scale</span><span class="op">)</span>, by.x <span class="op">=</span> <span class="st">"term"</span>, by.y <span class="op">=</span> <span class="st">"featureID"</span><span class="op">)</span>

<span class="va">dd</span><span class="op">[</span>, <span class="va">sig</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">p.value.adj</span> <span class="op">&lt;</span> <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">]</span>

<span class="fu"><a href="../reference/plot_volcano.html">plot_volcano</a></span><span class="op">(</span><span class="va">dd</span>, label <span class="op">=</span> <span class="st">"BIOCHEMICAL"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-38-1.png" width="700"></p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="association-analysis-3-multiple-outcomes-using-model-auto">Association analysis 3: multiple outcomes, using model = “auto”<a class="anchor" aria-label="anchor" href="#association-analysis-3-multiple-outcomes-using-model-auto"></a>
</h3>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regression.html">regression</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">df_plasma_scale</span>, phenoData <span class="op">=</span> <span class="cn">NULL</span>, 
                   model <span class="op">=</span> <span class="st">"auto"</span>, outcome <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BMI"</span>, <span class="st">"T2D"</span><span class="op">)</span>,
                   covars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>,<span class="st">"GENDER"</span>, <span class="st">"ETHNICITY"</span><span class="op">)</span>, 
                   factors <span class="op">=</span> <span class="st">"ETHNICITY"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Regression for 2 outcome(s). </span>
<span class="co">## </span>
<span class="co">## Build formula using covars and outcomes. </span>
<span class="co">## model = `auto`, to infer `lm` or `logistic` </span>
<span class="co">## </span>
<span class="co">## Run `lm` model for 545 features: </span>
<span class="co">## BMI ~ AGE + GENDER + ETHNICITY + `feature` </span>
<span class="co">## Build formula using covars and outcomes. </span>
<span class="co">## model = `auto`, to infer `lm` or `logistic` </span>
<span class="co">## </span>
<span class="co">## Run `logistic` model for 545 features: </span>
<span class="co">## T2D ~ AGE + GENDER + ETHNICITY + `feature`</span></code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##      term     estimate std.error   statistic   p.value   n outcome model</span>
<span class="co">## 1: M43027 -0.287065678 0.2909369 -0.98669400 0.3244762 356     BMI    lm</span>
<span class="co">## 2: M11953  0.285148910 0.2945365  0.96812761 0.3336511 356     BMI    lm</span>
<span class="co">## 3: M38002  0.063510129 0.2960686  0.21451153 0.8302735 356     BMI    lm</span>
<span class="co">## 4: M34404  0.459471416 0.3109698  1.47754337 0.1404319 356     BMI    lm</span>
<span class="co">## 5: M35963 -0.008355339 0.2942752 -0.02839294 0.9773650 356     BMI    lm</span>
<span class="co">## 6: M35728  0.280617622 0.2929012  0.95806251 0.3386944 356     BMI    lm</span>
<span class="co">##    p.value.adj</span>
<span class="co">## 1:           1</span>
<span class="co">## 2:           1</span>
<span class="co">## 3:           1</span>
<span class="co">## 4:           1</span>
<span class="co">## 5:           1</span>
<span class="co">## 6:           1</span></code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">fit2</span>, <span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">df_plasma_scale</span><span class="op">)</span>, by.x <span class="op">=</span> <span class="st">"term"</span>, by.y <span class="op">=</span> <span class="st">"featureID"</span><span class="op">)</span>

<span class="va">dd2</span><span class="op">[</span>, <span class="va">sig</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">p.value.adj</span> <span class="op">&lt;</span> <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="../reference/plot_volcano.html">plot_volcano</a></span><span class="op">(</span><span class="va">dd2</span>, color <span class="op">=</span> <span class="st">"outcome"</span>, label <span class="op">=</span> <span class="st">"BIOCHEMICAL"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-40-1.png" width="700"></p>
<p><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="roc">ROC<a class="anchor" aria-label="anchor" href="#roc"></a>
</h2>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ROC for one variable, to add a wrapped for many metabolites separately</span>
<span class="fu"><a href="../reference/plot_ROC.html">plot_ROC</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">df_plasma_scale</span>, y <span class="op">=</span> <span class="st">"T2D"</span>, x <span class="op">=</span> <span class="st">"M00527"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-41-1.png" width="864"></p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_ROC.html">plot_ROC</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">df_plasma_scale</span>, y <span class="op">=</span> <span class="st">"T2D"</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M00527"</span>, <span class="st">"BMI"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-41-2.png" width="864"></p>
<p><br><br></p>
<div class="section level3">
<h3 id="roc-compare-two-models">ROC: compare two models<a class="anchor" aria-label="anchor" href="#roc-compare-two-models"></a>
</h3>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_ROC.html">plot_ROC</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">df_plasma_scale</span>, y <span class="op">=</span> <span class="st">"T2D"</span>, 
         model_a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BMI"</span>, <span class="st">"AGE"</span>, <span class="st">"GENDER"</span><span class="op">)</span>, 
         model_b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"M00527"</span>, <span class="st">"BMI"</span>, <span class="st">"AGE"</span>, <span class="st">"GENDER"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-42-1.png" width="864"></p>
<p><br><br></p>
</div>
</div>
<div class="section level2">
<h2 id="extension">Extension<a class="anchor" aria-label="anchor" href="#extension"></a>
</h2>
<p>The metabolomicsR framework is versatile and is extensible to other
various methods, measurement platforms, and omics data types. Developers
can customize new visualization and statistical methods, or provide an
interface to deploy available statistical methods based on the
metabolomicsR data structure.</p>
<div class="section level3">
<h3 id="extension-1-negative-binomial-generalized-linear-models">Extension 1: Negative binomial generalized linear models<a class="anchor" aria-label="anchor" href="#extension-1-negative-binomial-generalized-linear-models"></a>
</h3>
<p>We have provided various regression models in the
<a href="https://github.com/XikunHan/metabolomicsR" class="external-link">metabolomicsR</a> package. Here we show how to extend the
<code>{regression}</code> function to other models.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># for example, to fit a Negative Binomial Generalized Linear Model, we first define a `fit_glm.nb` function. </span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span>

<span class="va">fit_glm.nb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">formula</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">keep</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">v_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/allnames.html" class="external-link">all.vars</a></span><span class="op">(</span><span class="va">formula</span><span class="op">)</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="va">v_var</span>, with <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>
  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"glm.nb"</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, formula <span class="op">=</span> <span class="va">formula</span><span class="op">)</span><span class="op">)</span>,
    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span>
      <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Failed to fit model: "</span>, <span class="va">e</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"glm"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">res</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">if</span><span class="op">(</span><span class="op">!</span> <span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">keep</span><span class="op">)</span><span class="op">)</span> <span class="va">res</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span><span class="va">res</span><span class="op">$</span><span class="va">term</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">keep</span>, <span class="op">]</span>
    <span class="va">res</span><span class="op">$</span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>estimate <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># the outcome 'toy_y' was only created to demonstrate the usage to extend regression models</span>

<span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_plasma_scale</span><span class="op">)</span><span class="op">[</span>, <span class="va">toy_y</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">BMI</span>, <span class="fl">0</span><span class="op">)</span><span class="op">]</span>

<span class="co"># equivalent to:</span>
<span class="kw">if</span><span class="op">(</span><span class="fl">0</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_plasma_scale</span><span class="op">)</span> 
  <span class="va">dd</span><span class="op">[</span>, <span class="va">toy_y</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">BMI</span>, <span class="fl">0</span><span class="op">)</span><span class="op">]</span>
  <span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df_plasma_scale</span><span class="op">)</span>  <span class="op">&lt;-</span> <span class="va">dd</span>
<span class="op">}</span>

<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regression.html">regression</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">df_plasma_scale</span>, phenoData <span class="op">=</span> <span class="cn">NULL</span>, model <span class="op">=</span> <span class="st">"glm.nb"</span>, outcome <span class="op">=</span> <span class="st">"toy_y"</span>,
                  covars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>,<span class="st">"GENDER"</span>, <span class="st">"ETHNICITY"</span><span class="op">)</span>, factors <span class="op">=</span> <span class="st">"ETHNICITY"</span>, 
                  feature_name <span class="op">=</span> <span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">df_plasma_scale</span><span class="op">)</span><span class="op">$</span><span class="va">featureID</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Regression for 1 outcome(s). </span>
<span class="co">## </span>
<span class="co">## Build formula using covars and outcomes. </span>
<span class="co">## </span>
<span class="co">## Run `glm.nb` model for 50 features: </span>
<span class="co">## toy_y ~ AGE + GENDER + ETHNICITY + `feature`</span></code></pre>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">fit</span>, <span class="fu"><a href="../reference/featureData.html">featureData</a></span><span class="op">(</span><span class="va">df_plasma_scale</span><span class="op">)</span>, by.x <span class="op">=</span> <span class="st">"term"</span>, by.y <span class="op">=</span> <span class="st">"featureID"</span><span class="op">)</span>
<span class="va">dd</span><span class="op">[</span>, <span class="va">sig</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">p.value.adj</span> <span class="op">&lt;</span> <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">]</span>
<span class="fu"><a href="../reference/plot_volcano.html">plot_volcano</a></span><span class="op">(</span><span class="va">dd</span>, color <span class="op">=</span> <span class="cn">NULL</span>, label <span class="op">=</span> <span class="st">"BIOCHEMICAL"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-44-1.png" width="700"><br></p>
</div>
<div class="section level3">
<h3 id="extension-2-call-available-methods-and-packages">Extension 2: Call available methods and packages<a class="anchor" aria-label="anchor" href="#extension-2-call-available-methods-and-packages"></a>
</h3>
<p>Here, we show an extension example to detect genuine untargeted
metabolic features based on a previous method (genuMet):</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res_genuMet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/genuMet_makefeature.html">genuMet_makefeature</a></span><span class="op">(</span><span class="va">df_plasma</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "70 windows in total"</span></code></pre>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">res_genuMet</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## List of 10</span>
<span class="co">##  $ mbnames     : chr [1:758] "M43027" "M11953" "M38002" "M34404" ...</span>
<span class="co">##  $ snames      : chr [1:356] "QMDiab222" "QMDiab113" "QMDiab29" "QMDiab243" ...</span>
<span class="co">##  $ wsize       : num 10</span>
<span class="co">##  $ ssize       : num 0.5</span>
<span class="co">##  $ defswitch   : num 0.2</span>
<span class="co">##  $ mrate       : num [1:758, 1:70] 0.3 0.5 0.3 0 0.4 0.1 0 0 0 0 ...</span>
<span class="co">##  $ meanmrate   : num [1:758] 0.1513 0.1443 0.0557 0.0371 0.08 ...</span>
<span class="co">##  $ variance    : num [1:758] 0.02139 0.02163 0.01497 0.00266 0.01554 ...</span>
<span class="co">##  $ nswitches   : int [1:758] 11 14 5 0 6 4 0 0 0 0 ...</span>
<span class="co">##  $ longestblock: num [1:758] 19 23 56 70 29 26 70 70 70 70 ...</span></code></pre>
<p><br></p>
</div>
<div class="section level3">
<h3 id="extension-3-bridge-to-maplet-package">Extension 3: Bridge to maplet package<a class="anchor" aria-label="anchor" href="#extension-3-bridge-to-maplet-package"></a>
</h3>
<p>In this section, we show two functions to bridge the data objects
between R package maplet and our package metabolomicsR.</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load the data from maplet. </span>
<span class="co"># the maplet package is available at: https://github.com/krumsieklab/maplet </span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">maplet</span><span class="op">)</span>

<span class="va">file_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example_data/simulated_data.xlsx"</span>, package <span class="op">=</span> <span class="st">"maplet"</span><span class="op">)</span>
<span class="va">file_data</span> </code></pre></div>
<pre><code><span class="co">## [1] "/Library/Frameworks/R.framework/Versions/4.1/Resources/library/maplet/extdata/example_data/simulated_data.xlsx"</span></code></pre>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maplet_data</span> <span class="op">&lt;-</span>
  <span class="fu">maplet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maplet/man/mt_load_checksum.html" class="external-link">mt_load_checksum</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">file_data</span>, checksum <span class="op">=</span> <span class="st">"80afcd72481c6cf3dcf83342e3513699"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">maplet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maplet/man/mt_load_xls.html" class="external-link">mt_load_xls</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">file_data</span>, sheet<span class="op">=</span><span class="st">"data"</span>, samples_in_row<span class="op">=</span><span class="cn">T</span>, id_col<span class="op">=</span><span class="st">"sample"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">maplet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maplet/man/mt_anno_xls.html" class="external-link">mt_anno_xls</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">file_data</span>, sheet<span class="op">=</span><span class="st">"metinfo"</span>,anno_type<span class="op">=</span><span class="st">"features"</span>, anno_id_col<span class="op">=</span><span class="st">"name"</span>, data_id_col <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu">maplet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maplet/man/mt_anno_xls.html" class="external-link">mt_anno_xls</a></span><span class="op">(</span>file<span class="op">=</span><span class="va">file_data</span>, sheet<span class="op">=</span><span class="st">"clin"</span>, anno_type<span class="op">=</span><span class="st">"samples"</span>, anno_id_col <span class="op">=</span><span class="st">"sample"</span>, data_id_col <span class="op">=</span><span class="st">"sample"</span><span class="op">)</span> </code></pre></div>
<pre><code><span class="co">## 2022-08-19 11:33:16 INFO:mt:Correct checksum for /Library/Frameworks/R.framework/Versions/4.1/Resources/library/maplet/extdata/example_data/simulated_data.xlsx: 80afcd72481c6cf3dcf83342e3513699</span>
<span class="co">## 2022-08-19 11:33:17 INFO:mt:loaded assay from Excel file 'simulated_data.xlsx, sheet 'data'</span>
<span class="co">## 2022-08-19 11:33:17 INFO:mt:loaded features annotations from Excel file 'simulated_data.xlsx, sheet 'metinfo'</span>
<span class="co">## 2022-08-19 11:33:17 INFO:mt:loaded samples annotations from Excel file 'simulated_data.xlsx, sheet 'clin'</span></code></pre>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">maplet_data</span></code></pre></div>
<pre><code><span class="co">## class: SummarizedExperiment </span>
<span class="co">## dim: 1272 500 </span>
<span class="co">## metadata(2): sessionInfo results</span>
<span class="co">## assays(1): ''</span>
<span class="co">## rownames(1272): X.14.or.15..methylpalmitate..a17.0.or.i17.0.</span>
<span class="co">##   X.16.or.17..methylstearate..a19.0.or.i19.0. ... X...26111 X...26119</span>
<span class="co">## rowData names(15): name PATHWAY_SORTORDER ... HMDb COMP_IDstr</span>
<span class="co">## colnames(500): sample001 sample002 ... sample499 sample500</span>
<span class="co">## colData names(6): sample BOX.NUMBER ... PreBioPSA Diagnosis</span></code></pre>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maplet2Metabolite.html">maplet2Metabolite</a></span><span class="op">(</span><span class="va">maplet_data</span><span class="op">)</span>

<span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Metabolite2maplet.html">Metabolite2maplet</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 2022-08-19 11:33:21 INFO:mt:Checksum for tmp_data_convert.xlsx: 4a16466287b21b4c60f3f30735af47ba</span>
<span class="co">## 2022-08-19 11:33:23 INFO:mt:loaded assay from Excel file 'tmp_data_convert.xlsx, sheet 'assayData'</span>
<span class="co">## 2022-08-19 11:33:23 INFO:mt:loaded samples annotations from Excel file 'tmp_data_convert.xlsx, sheet 'sampleData'</span>
<span class="co">## 2022-08-19 11:33:23 INFO:mt:loaded features annotations from Excel file 'tmp_data_convert.xlsx, sheet 'featureData'</span></code></pre>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d2</span></code></pre></div>
<pre><code><span class="co">## class: SummarizedExperiment </span>
<span class="co">## dim: 1272 500 </span>
<span class="co">## metadata(2): sessionInfo results</span>
<span class="co">## assays(1): ''</span>
<span class="co">## rownames(1272): X.14.or.15..methylpalmitate..a17.0.or.i17.0.</span>
<span class="co">##   X.16.or.17..methylstearate..a19.0.or.i19.0. ... X...26111 X...26119</span>
<span class="co">## rowData names(16): name PATHWAY_SORTORDER ... COMP_IDstr featureID</span>
<span class="co">## colnames(500): sample001 sample002 ... sample499 sample500</span>
<span class="co">## colData names(6): sampleID BOX.NUMBER ... PreBioPSA Diagnosis</span></code></pre>
<p><br></p>
<details><summary><strong>click to show data d</strong>
</summary><div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span></code></pre></div>
<pre><code><span class="co">## An object of  Metabolite </span>
<span class="co">## </span>
<span class="co">## ***  @assayData (first and last 10 columns [ 500  *  1273 ])  ***</span>
<span class="co">##       sampleID (14 or 15)-methylpalmitate (a17:0 or i17:0)</span>
<span class="co">##   1: sample001                                   0.4630064</span>
<span class="co">##   2: sample002                                   0.6736669</span>
<span class="co">##   3: sample003                                   0.4646775</span>
<span class="co">##   4: sample004                                   2.5230366</span>
<span class="co">##   5: sample005                                   1.0024304</span>
<span class="co">##  ---                                                      </span>
<span class="co">## 496: sample496                                   0.3490609</span>
<span class="co">## 497: sample497                                   5.2587385</span>
<span class="co">## 498: sample498                                   0.6258889</span>
<span class="co">## 499: sample499                                   5.8510527</span>
<span class="co">## 500: sample500                                   1.2045300</span>
<span class="co">##      (16 or 17)-methylstearate (a19:0 or i19:0)</span>
<span class="co">##   1:                                  0.9602430</span>
<span class="co">##   2:                                  0.6910923</span>
<span class="co">##   3:                                  0.6157965</span>
<span class="co">##   4:                                  1.1808766</span>
<span class="co">##   5:                                  0.5401380</span>
<span class="co">##  ---                                           </span>
<span class="co">## 496:                                  0.3475324</span>
<span class="co">## 497:                                  7.8537198</span>
<span class="co">## 498:                                  1.3483889</span>
<span class="co">## 499:                                  6.3016673</span>
<span class="co">## 500:                                  1.7437632</span>
<span class="co">##      (2 or 3)-decenoate (10:1n7 or n8) (2,4 or 2,5)-dimethylphenol sulfate</span>
<span class="co">##   1:                        1.08304377                           1.8796069</span>
<span class="co">##   2:                        0.37873010                           2.2679485</span>
<span class="co">##   3:                        1.54721194                           1.4949470</span>
<span class="co">##   4:                        0.70232145                           1.1180773</span>
<span class="co">##   5:                        1.08623823                           1.0879467</span>
<span class="co">##  ---                                                                      </span>
<span class="co">## 496:                        0.08517315                           6.6108498</span>
<span class="co">## 497:                        1.56126481                           1.8130962</span>
<span class="co">## 498:                        0.24556055                           2.1242071</span>
<span class="co">## 499:                        2.35396933                           0.4033126</span>
<span class="co">## 500:                        2.37010550                           4.7821229</span>
<span class="co">##      (N(1) + N(8))-acetylspermidine (R)-3-hydroxybutyrylcarnitine</span>
<span class="co">##   1:                      7.7598199                     2.0369651</span>
<span class="co">##   2:                      3.1519376                     0.8140144</span>
<span class="co">##   3:                      2.2002129                     3.1411360</span>
<span class="co">##   4:                      0.5464129                     1.6095777</span>
<span class="co">##   5:                      0.3669653                     0.8542124</span>
<span class="co">##  ---                                                             </span>
<span class="co">## 496:                      3.3164608                     0.2808442</span>
<span class="co">## 497:                      3.8375473                     5.6771023</span>
<span class="co">## 498:                      0.5126274                     0.4829744</span>
<span class="co">## 499:                      0.4541196                     3.1458493</span>
<span class="co">## 500:                      0.3570317                     0.8408063</span>
<span class="co">##      (S)-3-hydroxybutyrylcarnitine (S)-a-amino-omega-caprolactam</span>
<span class="co">##   1:                     1.2356209                     1.4382760</span>
<span class="co">##   2:                     1.8791330                     4.9548968</span>
<span class="co">##   3:                     1.0620380                     3.3874263</span>
<span class="co">##   4:                     1.5239369                     0.3047130</span>
<span class="co">##   5:                     0.9325866                     1.1757372</span>
<span class="co">##  ---                                                            </span>
<span class="co">## 496:                     0.6863713                     1.9181121</span>
<span class="co">## 497:                     1.8170800                     0.2729461</span>
<span class="co">## 498:                     0.5400009                     3.4931639</span>
<span class="co">## 499:                     0.1605216                     0.3252986</span>
<span class="co">## 500:                     0.5947355                     9.7138533</span>
<span class="co">##      1,2,3-benzenetriol sulfate (1)  X - 25855 X - 25948 X - 25957 X - 26008</span>
<span class="co">##   1:                      0.1535775 0.48662437 1.3314341 0.7907694 0.6922478</span>
<span class="co">##   2:                      1.4870696 2.63292722 1.6590000 0.3534786 1.2882641</span>
<span class="co">##   3:                      0.6982819 0.09533669 1.1414791 0.6189538 0.8988873</span>
<span class="co">##   4:                      0.6066992 0.49394023 0.4793454 0.6774228 0.5771596</span>
<span class="co">##   5:                      0.5999365 1.88549387 2.7259096 1.0158115 0.6366115</span>
<span class="co">##  ---                                                                        </span>
<span class="co">## 496:                      1.1504560 0.70000277 1.7873999 0.4652481 1.0835597</span>
<span class="co">## 497:                      0.4635507 0.95791596 0.1465094 0.9131220 0.6003898</span>
<span class="co">## 498:                      1.5307533 4.42951313 2.0858099 0.3742364 0.7091317</span>
<span class="co">## 499:                      5.1191430 1.42607928 1.1940926 0.6341707 3.4946457</span>
<span class="co">## 500:                      1.7952270 1.26352884 0.5875895 1.4872003 0.5925226</span>
<span class="co">##       X - 26054 X - 26062 X - 26097  X - 26107 X - 26109 X - 26111 X - 26119</span>
<span class="co">##   1: 2.91268398 2.6521087 0.3102903  1.0196514 0.5812915 0.9291756 0.5367705</span>
<span class="co">##   2: 0.34849199 1.0109160 1.0438776  0.1726276 0.2570697 9.1268144 7.6833468</span>
<span class="co">##   3: 0.69354781 3.3446319 0.4388419  1.2010741 1.4585889 0.4401262 0.7477361</span>
<span class="co">##   4: 0.09875882 0.3260873 0.1904927  1.2171145 1.7501699 1.4402568 1.3596949</span>
<span class="co">##   5: 1.79734582 0.8871074 1.7840008  0.9347244 1.6771602 0.2708704 1.8076262</span>
<span class="co">##  ---                                                                        </span>
<span class="co">## 496: 3.70181028 1.0176108 0.7197407  0.1247540 6.6045423 1.0406426 3.5358712</span>
<span class="co">## 497: 1.16477003 1.1979145 1.2837556 11.7150786 0.8252360 2.9018338 0.4595117</span>
<span class="co">## 498: 3.15426529 0.3026371 0.3554645  2.1117014 2.8021829 2.2791829 9.2401024</span>
<span class="co">## 499: 0.33608038 2.2861689 0.9228734  1.5726954 2.4197879 4.0711762 0.2660358</span>
<span class="co">## 500: 3.95024566 1.8051881 2.8748114  1.1531895 1.4318224 1.2287339 0.4002133</span>
<span class="co">## </span>
<span class="co">## ***  @featureData (ID:  featureID ) ***</span>
<span class="co">##                                         featureID PATHWAY_SORTORDER</span>
<span class="co">##    1: (14 or 15)-methylpalmitate (a17:0 or i17:0)              1573</span>
<span class="co">##    2:  (16 or 17)-methylstearate (a19:0 or i19:0)              1579</span>
<span class="co">##    3:           (2 or 3)-decenoate (10:1n7 or n8)              1430</span>
<span class="co">##    4:         (2,4 or 2,5)-dimethylphenol sulfate              5001</span>
<span class="co">##    5:              (N(1) + N(8))-acetylspermidine               505</span>
<span class="co">##   ---                                                              </span>
<span class="co">## 1268:                                   X - 26097                NA</span>
<span class="co">## 1269:                                   X - 26107                NA</span>
<span class="co">## 1270:                                   X - 26109                NA</span>
<span class="co">## 1271:                                   X - 26111                NA</span>
<span class="co">## 1272:                                   X - 26119                NA</span>
<span class="co">##                                       BIOCHEMICAL SUPER_PATHWAY</span>
<span class="co">##    1: (14 or 15)-methylpalmitate (a17:0 or i17:0)         Lipid</span>
<span class="co">##    2:  (16 or 17)-methylstearate (a19:0 or i19:0)         Lipid</span>
<span class="co">##    3:           (2 or 3)-decenoate (10:1n7 or n8)         Lipid</span>
<span class="co">##    4:         (2,4 or 2,5)-dimethylphenol sulfate   Xenobiotics</span>
<span class="co">##    5:              (N(1) + N(8))-acetylspermidine    Amino Acid</span>
<span class="co">##   ---                                                          </span>
<span class="co">## 1268:                                   X - 26097          &lt;NA&gt;</span>
<span class="co">## 1269:                                   X - 26107          &lt;NA&gt;</span>
<span class="co">## 1270:                                   X - 26109          &lt;NA&gt;</span>
<span class="co">## 1271:                                   X - 26111          &lt;NA&gt;</span>
<span class="co">## 1272:                                   X - 26119          &lt;NA&gt;</span>
<span class="co">##                   SUB_PATHWAY COMP_ID        PLATFORM CHEMICAL_ID   RI     MASS</span>
<span class="co">##    1:    Fatty Acid, Branched   38768       LC/MS Neg   100002945 5695 269.2487</span>
<span class="co">##    2:    Fatty Acid, Branched   38296       LC/MS Neg   100002356 5993 297.2799</span>
<span class="co">##    3: Medium Chain Fatty Acid   63436       LC/MS Neg   100021502 4990 169.1234</span>
<span class="co">##    4:    Food Component/Plant   62533       LC/MS Neg   100020519 3474 201.0227</span>
<span class="co">##    5:    Polyamine Metabolism   57814 LC/MS Pos Early   100016038 3080 188.1757</span>
<span class="co">##   ---                                                                          </span>
<span class="co">## 1268:                    &lt;NA&gt;   64372 LC/MS Pos Early          NA   NA       NA</span>
<span class="co">## 1269:                    &lt;NA&gt;   64396  LC/MS Pos Late          NA   NA       NA</span>
<span class="co">## 1270:                    &lt;NA&gt;   64399       LC/MS Neg          NA   NA       NA</span>
<span class="co">## 1271:                    &lt;NA&gt;   64401       LC/MS Neg          NA   NA       NA</span>
<span class="co">## 1272:                    &lt;NA&gt;   64440       LC/MS Neg          NA   NA       NA</span>
<span class="co">##       PUBCHEM       CAS KEGG      HMDb COMP_IDstr</span>
<span class="co">##    1:    &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;     M38768</span>
<span class="co">##    2: 3083779 2724-59-6 &lt;NA&gt; HMDB37397     M38296</span>
<span class="co">##    3:    &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;     M63436</span>
<span class="co">##    4:    &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;     M62533</span>
<span class="co">##    5:    &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;     M57814</span>
<span class="co">##   ---                                            </span>
<span class="co">## 1268:    &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;     M64372</span>
<span class="co">## 1269:    &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;     M64396</span>
<span class="co">## 1270:    &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;     M64399</span>
<span class="co">## 1271:    &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;     M64401</span>
<span class="co">## 1272:    &lt;NA&gt;      &lt;NA&gt; &lt;NA&gt;      &lt;NA&gt;     M64440</span>
<span class="co">## </span>
<span class="co">## ***  @sampleData (ID:  sampleID ) ***</span>
<span class="co">##       sampleID BOX.NUMBER      Age Ethnicity PreBioPSA Diagnosis</span>
<span class="co">##   1: sample001       Box7 64.63321         1  6.768448         1</span>
<span class="co">##   2: sample002       Box5 73.09786         1  6.768448         1</span>
<span class="co">##   3: sample003       Box6 64.15168         1  6.768448         0</span>
<span class="co">##   4: sample004       Box6 63.81563         1  6.768448         1</span>
<span class="co">##   5: sample005       Box1 67.39195         1  6.768448         0</span>
<span class="co">##  ---                                                            </span>
<span class="co">## 496: sample496       Box4 64.52742         1  6.768448         0</span>
<span class="co">## 497: sample497       Box5 71.47279         1  6.768448         1</span>
<span class="co">## 498: sample498       Box5 60.74075         1  6.768448         1</span>
<span class="co">## 499: sample499       Box6 57.70867         1  6.768448         1</span>
<span class="co">## 500: sample500       Box1 64.92959         1  6.768448         0</span>
<span class="co">## </span>
<span class="co">## ***  @miscData  ***</span>
<span class="co">## sessionInfo     results </span>
<span class="co">##          13           4 </span>
<span class="co">## </span>
<span class="co">## ***  @logs  ***</span>
<span class="co">## 19/08/22 11:33:18: Convert data from maplet data.</span>
<span class="co">## 19/08/22 11:33:18: Initiate data: 500 samples and 1272 features.</span></code></pre>
</details><p><br></p>
</div>
<div class="section level3">
<h3 id="extension-4-nightingales-nmr-platform">Extension 4: Nightingale’s NMR platform<a class="anchor" aria-label="anchor" href="#extension-4-nightingales-nmr-platform"></a>
</h3>
<p>In this section, we show the application of our metabolomicsR package
to Nightingale’s NMR platform data, including data import,
transformation, visualization, and association analysis.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the Nightingale data were downloaded from https://nightingalehealth.github.io/ggforestplot/articles/nmr-data-analysis-tutorial.html</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span>
<span class="va">df_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"~/Documents/test/NightingaleData/12345-Results.csv"</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">df_data</span>, <span class="fl">1</span>, <span class="st">"sampleID"</span><span class="op">)</span>

<span class="va">df_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html" class="external-link">fread</a></span><span class="op">(</span><span class="st">"~/Documents/test/NightingaleData/clinical_data.csv"</span><span class="op">)</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">df_sample</span>, <span class="fl">1</span>, <span class="st">"sampleID"</span><span class="op">)</span>
<span class="va">df_sample</span><span class="op">$</span><span class="va">sampleID</span> <span class="op">&lt;-</span> <span class="va">df_data</span><span class="op">$</span><span class="va">sampleID</span>

<span class="va">df_feature</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>featureID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">df_data</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>

<span class="co"># create Metabolite object</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_Metabolite.html">create_Metabolite</a></span><span class="op">(</span><span class="va">df_data</span>, <span class="va">df_feature</span> ,<span class="va">df_sample</span><span class="op">)</span>

<span class="fu"><a href="../reference/sampleData.html">sampleData</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">[</span>, <span class="va">obesity</span> <span class="op">:=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">BMI</span> <span class="op">&gt;=</span> <span class="fl">30</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">]</span>

<span class="fu"><a href="../reference/plot_Metabolite.html">plot_Metabolite</a></span><span class="op">(</span><span class="va">df</span>, plot <span class="op">=</span> <span class="st">"boxplot"</span>, x <span class="op">=</span> <span class="st">"obesity"</span>, color <span class="op">=</span><span class="st">"obesity"</span>, shape <span class="op">=</span> <span class="st">"obesity"</span>, feature_name <span class="op">=</span> <span class="st">"GlycA"</span><span class="op">)</span></code></pre></div>
<p><img src="Introduction_files/figure-html/unnamed-chunk-48-1.png" width="700"></p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Transformation</span>
<span class="va">df</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/transformation.html">transformation</a></span><span class="op">(</span><span class="va">df</span>, method <span class="op">=</span> <span class="st">"log1p"</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/transformation.html">transformation</a></span><span class="op">(</span><span class="va">df</span>, method <span class="op">=</span> <span class="st">"scale"</span><span class="op">)</span>


<span class="co"># Association of BMI (as exposure) and each metabolite (as outcome)</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regression.html">regression_each_as_outcome</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">df</span>, phenoData <span class="op">=</span> <span class="cn">NULL</span>, exposure <span class="op">=</span> <span class="st">"BMI"</span>, 
                                  feature_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Total_C"</span>, <span class="st">"non_HDL_C"</span>, <span class="st">"Remnant_C"</span>, <span class="st">"VLDL_C"</span>, <span class="st">"Clinical_LDL_C"</span><span class="op">)</span>,
                                  covars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gender"</span>, <span class="st">"baseline_age"</span><span class="op">)</span>, factors <span class="op">=</span> <span class="st">"gender"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Run `lm` model for 5 features: </span>
<span class="co">## `feature` ~ BMI + gender + baseline_age</span></code></pre>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the results were the same as the "nmr-data-analysis-tutorial.html"</span>
<span class="va">fit</span></code></pre></div>
<pre><code><span class="co">##    term   estimate   std.error statistic      p.value    n        outcome</span>
<span class="co">## 1:  BMI 0.01691751 0.005443141  3.108042 1.911458e-03 1887        Total_C</span>
<span class="co">## 2:  BMI 0.02934311 0.005361011  5.473428 5.005349e-08 1887      non_HDL_C</span>
<span class="co">## 3:  BMI 0.03026573 0.005351079  5.656005 1.786960e-08 1887      Remnant_C</span>
<span class="co">## 4:  BMI 0.04278407 0.005261748  8.131150 7.627291e-16 1887         VLDL_C</span>
<span class="co">## 5:  BMI 0.02508980 0.005406182  4.640946 3.707453e-06 1887 Clinical_LDL_C</span>
<span class="co">##    exposure model  p.value.adj</span>
<span class="co">## 1:      BMI    lm 9.557289e-03</span>
<span class="co">## 2:      BMI    lm 2.502674e-07</span>
<span class="co">## 3:      BMI    lm 8.934801e-08</span>
<span class="co">## 4:      BMI    lm 3.813646e-15</span>
<span class="co">## 5:      BMI    lm 1.853727e-05</span></code></pre>
<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Ejigu,B.A. et al. (2013) Evaluation of normalization methods to pave
the way towards large-scale LC-MS-based metabolomics profiling
experiments. OMICS, 17, 473–485.</li>
<li>Johnson,C.H. et al. (2016) Metabolomics: beyond biomarkers and
towards mechanisms. Nat. Rev. Mol. Cell Biol., 17, 451–459.</li>
<li>Long,N.P. et al. (2020) Toward a Standardized Strategy of Clinical
Metabolomics for the Advancement of Precision Medicine. Metabolites,
10.</li>
<li>Pinu,F.R. et al. (2019) Systems Biology and Multi-Omics Integration:
Viewpoints from the Metabolomics Research Community. Metabolites,
9.</li>
<li>Stanstrup,J. et al. (2019) The metaRbolomics Toolbox in Bioconductor
and beyond. Metabolites, 9.</li>
<li>Cao,L. et al. (2019) genuMet: distinguish genuine untargeted
metabolic features without quality control samples. bioRxiv,
837260.</li>
<li>Yousri,N.A. et al. (2015) A systems view of type 2
diabetes-associated metabolic perturbations in saliva, blood and urine
at different timescales of glycaemic control. Diabetologia, 58,
1855–1867.</li>
</ul>
<p><br><br></p>
<details><summary><strong>Session Info</strong>
</summary><div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## R version 4.1.2 (2021-11-01)</span>
<span class="co">## Platform: x86_64-apple-darwin17.0 (64-bit)</span>
<span class="co">## Running under: macOS Big Sur 10.16</span>
<span class="co">## </span>
<span class="co">## Matrix products: default</span>
<span class="co">## BLAS:   /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRblas.0.dylib</span>
<span class="co">## LAPACK: /Library/Frameworks/R.framework/Versions/4.1/Resources/lib/libRlapack.dylib</span>
<span class="co">## </span>
<span class="co">## locale:</span>
<span class="co">## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span>
<span class="co">## </span>
<span class="co">## attached base packages:</span>
<span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span>
<span class="co">## [8] base     </span>
<span class="co">## </span>
<span class="co">## other attached packages:</span>
<span class="co">##  [1] maplet_1.1.2                SummarizedExperiment_1.24.0</span>
<span class="co">##  [3] Biobase_2.54.0              GenomicRanges_1.46.1       </span>
<span class="co">##  [5] GenomeInfoDb_1.30.1         IRanges_2.28.0             </span>
<span class="co">##  [7] S4Vectors_0.32.4            BiocGenerics_0.40.0        </span>
<span class="co">##  [9] MatrixGenerics_1.6.0        matrixStats_0.62.0         </span>
<span class="co">## [11] magrittr_2.0.3              MASS_7.3-56                </span>
<span class="co">## [13] stringr_1.4.0               plotROC_2.3.0              </span>
<span class="co">## [15] cowplot_1.1.1               ggplot2_3.3.6              </span>
<span class="co">## [17] data.table_1.14.2           metabolomicsR_1.0.0        </span>
<span class="co">## [19] BiocStyle_2.20.2           </span>
<span class="co">## </span>
<span class="co">## loaded via a namespace (and not attached):</span>
<span class="co">##   [1] utf8_1.2.2             reticulate_1.25        tidyselect_1.1.2      </span>
<span class="co">##   [4] RSQLite_2.2.15         AnnotationDbi_1.56.2   grid_4.1.2            </span>
<span class="co">##   [7] Rtsne_0.16             pROC_1.18.0            munsell_0.5.0         </span>
<span class="co">##  [10] codetools_0.2-18       ragg_1.2.2             effectsize_0.6.0.1    </span>
<span class="co">##  [13] umap_0.2.8.0           future_1.27.0          M3C_1.14.0            </span>
<span class="co">##  [16] withr_2.5.0            colorspace_2.0-3       progressr_0.10.0      </span>
<span class="co">##  [19] uuid_1.1-0             highr_0.9              knitr_1.38            </span>
<span class="co">##  [22] rstudioapi_0.13        Rttf2pt1_1.3.10        pathview_1.34.0       </span>
<span class="co">##  [25] listenv_0.8.0          labeling_0.4.2         KEGGgraph_1.54.0      </span>
<span class="co">##  [28] GenomeInfoDbData_1.2.7 mnormt_2.1.0           bit64_4.0.5           </span>
<span class="co">##  [31] farver_2.1.1           datawizard_0.4.0       pheatmap_1.0.12       </span>
<span class="co">##  [34] rprojroot_2.0.3        coda_0.19-4            parallelly_1.32.1     </span>
<span class="co">##  [37] vctrs_0.4.1            generics_0.1.3         xfun_0.32             </span>
<span class="co">##  [40] R6_2.5.1               doParallel_1.0.17      BayesFactor_0.9.12-4.3</span>
<span class="co">##  [43] bitops_1.0-7           cachem_1.0.6           reshape_0.8.8         </span>
<span class="co">##  [46] DelayedArray_0.20.0    assertthat_0.2.1       MatrixEQTL_2.3        </span>
<span class="co">##  [49] scales_1.2.0           googlesheets4_1.0.0    gtable_0.3.0          </span>
<span class="co">##  [52] globals_0.16.0         tictoc_1.0.1           rlang_1.0.4           </span>
<span class="co">##  [55] MatrixModels_0.5-0     zeallot_0.1.0          systemfonts_1.0.4     </span>
<span class="co">##  [58] splines_4.1.2          extrafontdb_1.0        gargle_1.2.0          </span>
<span class="co">##  [61] genuMet_1.0.1          broom_1.0.0            prismatic_1.1.0       </span>
<span class="co">##  [64] modelr_0.1.8           BiocManager_1.30.16    yaml_2.3.5            </span>
<span class="co">##  [67] reshape2_1.4.4         ggnetwork_0.5.10       backports_1.4.1       </span>
<span class="co">##  [70] extrafont_0.17         tools_4.1.2            psych_2.2.5           </span>
<span class="co">##  [73] bookdown_0.25          logging_0.10-108       statnet.common_4.6.0  </span>
<span class="co">##  [76] ellipsis_0.3.2         jquerylib_0.1.4        RColorBrewer_1.1-3    </span>
<span class="co">##  [79] WRS2_1.1-3             Rcpp_1.0.9             plyr_1.8.7            </span>
<span class="co">##  [82] zlibbioc_1.40.0        purrr_0.3.4            RCurl_1.98-1.6        </span>
<span class="co">##  [85] openssl_2.0.2          pbapply_1.5-0          hmdbQuery_1.12.1      </span>
<span class="co">##  [88] correlation_0.8.0      haven_2.5.0            ggrepel_0.9.1         </span>
<span class="co">##  [91] cluster_2.1.3          hrbrthemes_0.8.0       fs_1.5.2              </span>
<span class="co">##  [94] RSpectra_0.16-1        openxlsx_4.2.5         reprex_2.0.1          </span>
<span class="co">##  [97] googledrive_2.0.0      mvtnorm_1.1-3          matrixcalc_1.0-5      </span>
<span class="co">## [100] hms_1.1.1              patchwork_1.1.1        evaluate_0.16         </span>
<span class="co">## [103] XML_3.99-0.10          readxl_1.4.0           compiler_4.1.2        </span>
<span class="co">## [106] tibble_3.1.8           ggstatsplot_0.9.1      crayon_1.5.1.9000     </span>
<span class="co">## [109] htmltools_0.5.3        tzdb_0.3.0             corpcor_1.6.10        </span>
<span class="co">## [112] mc2d_0.1-21            snow_0.4-4             tidyr_1.2.0           </span>
<span class="co">## [115] lubridate_1.8.0        DBI_1.1.3              dbplyr_2.2.1          </span>
<span class="co">## [118] boot_1.3-28            readr_2.1.2            Matrix_1.4-1          </span>
<span class="co">## [121] cli_3.3.0              parallel_4.1.2         insight_0.17.0        </span>
<span class="co">## [124] forcats_0.5.1          pkgconfig_2.0.3        pkgdown_2.0.2         </span>
<span class="co">## [127] statsExpressions_1.3.1 xml2_1.3.3             paletteer_1.4.0       </span>
<span class="co">## [130] foreach_1.5.2          bslib_0.4.0            XVector_0.34.0        </span>
<span class="co">## [133] rvest_1.0.2            digest_0.6.29          parameters_0.17.0     </span>
<span class="co">## [136] graph_1.72.0           Biostrings_2.62.0      rmarkdown_2.13        </span>
<span class="co">## [139] cellranger_1.1.0       gdtools_0.2.4          curl_4.3.2            </span>
<span class="co">## [142] gtools_3.9.3           nlme_3.1-157           lifecycle_1.0.1       </span>
<span class="co">## [145] jsonlite_1.8.0         network_1.17.2         desc_1.4.1            </span>
<span class="co">## [148] sgi_0.0.0.9000         askpass_1.1            fansi_1.0.3           </span>
<span class="co">## [151] pillar_1.8.0           lattice_0.20-45        KEGGREST_1.34.0       </span>
<span class="co">## [154] fastmap_1.1.0          httr_1.4.3             survival_3.3-1        </span>
<span class="co">## [157] glue_1.6.2             bayestestR_0.11.5      zip_2.2.0             </span>
<span class="co">## [160] FNN_1.1.3              png_0.1-7              iterators_1.0.14      </span>
<span class="co">## [163] bit_4.0.4              Rgraphviz_2.38.0       stringi_1.7.8         </span>
<span class="co">## [166] sass_0.4.2             performance_0.9.0      rematch2_2.1.2        </span>
<span class="co">## [169] blob_1.2.3             textshaping_0.3.6      org.Hs.eg.db_3.14.0   </span>
<span class="co">## [172] doSNOW_1.0.20          memoise_2.0.1          dplyr_1.0.9           </span>
<span class="co">## [175] tidyverse_1.3.2</span></code></pre>
</details>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Xikun Han.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
